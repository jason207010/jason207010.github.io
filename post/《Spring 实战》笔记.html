<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>《Spring 实战》笔记 - Jason&#39;s Blog</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#F2F2F2" />
<meta name="msapplication-navbutton-color" content="#F2F2F2">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#F2F2F2">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Jason" />
  <meta name="description" content="Bean的生命周期 Spring Bean 装配Bean 隐式自动装配 基于annotation方式 1 2 3 @Configuration @ComponentScan public class AppConfig {} 基于XML方式 1 2 3 4 5 6 7 8 9 10 11 12 13 &amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt; &amp;lt;beans" />

  <meta name="keywords" content="Jason&#39;s Blog" />






<meta name="generator" content="Hugo 0.85.0" />


<link rel="canonical" href="http://jason207010.github.io/post/%E3%80%8ASpring%20%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0.html" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.6a5536f5d1353a14ec7d9bc106930d2305e46da3a91b609054582a4a82594cf8.css" integrity="sha256-alU29dE1OhTsfZvBBpMNIwXkbaOpG2CQVFgqSoJZTPg=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="《Spring 实战》笔记" />
<meta property="og:description" content="Bean的生命周期 Spring Bean 装配Bean 隐式自动装配 基于annotation方式 1 2 3 @Configuration @ComponentScan public class AppConfig {} 基于XML方式 1 2 3 4 5 6 7 8 9 10 11 12 13 &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;beans" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://jason207010.github.io/post/%E3%80%8ASpring%20%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0.html" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2017-07-14T00:00:00+00:00" />
<meta property="article:modified_time" content="2017-07-14T00:00:00+00:00" />

<meta itemprop="name" content="《Spring 实战》笔记">
<meta itemprop="description" content="Bean的生命周期 Spring Bean 装配Bean 隐式自动装配 基于annotation方式 1 2 3 @Configuration @ComponentScan public class AppConfig {} 基于XML方式 1 2 3 4 5 6 7 8 9 10 11 12 13 &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;beans"><meta itemprop="datePublished" content="2017-07-14T00:00:00+00:00" />
<meta itemprop="dateModified" content="2017-07-14T00:00:00+00:00" />
<meta itemprop="wordCount" content="14727">
<meta itemprop="keywords" content="Java,Spring," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="《Spring 实战》笔记"/>
<meta name="twitter:description" content="Bean的生命周期 Spring Bean 装配Bean 隐式自动装配 基于annotation方式 1 2 3 @Configuration @ComponentScan public class AppConfig {} 基于XML方式 1 2 3 4 5 6 7 8 9 10 11 12 13 &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;beans"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




<link rel="stylesheet"
      href="/lib/highlight/default.min.css">
<script src="/lib/highlight/highlight.min.js"></script>

<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Jason's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://jason207010.github.io/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://jason207010.github.io/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://jason207010.github.io/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://jason207010.github.io/categories/">Categories</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css" integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css" integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin="anonymous">




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Jason's Blog
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://jason207010.github.io/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://jason207010.github.io/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://jason207010.github.io/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://jason207010.github.io/categories/">Categories</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">《Spring 实战》笔记</h1>
      
      <div class="post-meta">
        <time datetime="2017-07-14" class="post-time">
          2017-07-14
        </time>
        <div class="post-category">
            <a href="http://jason207010.github.io/categories/java/"> Java </a>
            <a href="http://jason207010.github.io/categories/spring/"> Spring </a>
            
          </div>
        <span class="more-meta"> 约 14727 字 </span>
          <span class="more-meta"> 预计阅读 30 分钟 </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#bean的生命周期">Bean的生命周期</a></li>
    <li><a href="#spring-bean">Spring Bean</a>
      <ul>
        <li><a href="#装配bean">装配Bean</a></li>
        <li><a href="#依赖注入">依赖注入</a></li>
        <li><a href="#注入外部的值">注入外部的值</a></li>
        <li><a href="#bean的作用域">Bean的作用域</a></li>
      </ul>
    </li>
    <li><a href="#面向切面编程aop">面向切面编程（AOP）</a>
      <ul>
        <li><a href="#启用aop功能">启用AOP功能</a></li>
        <li><a href="#aop代理">AOP代理</a></li>
        <li><a href="#切面">切面</a></li>
        <li><a href="#切点">切点</a></li>
        <li><a href="#通知">通知</a></li>
      </ul>
    </li>
    <li><a href="#spring-mvc">Spring MVC</a>
      <ul>
        <li><a href="#跟踪spring-mvc的请求">跟踪Spring MVC的请求</a></li>
        <li><a href="#spring-mvc配置">Spring MVC配置</a></li>
        <li><a href="#处理请求参数">处理请求参数</a></li>
        <li><a href="#渲染web视图">渲染Web视图</a></li>
        <li><a href="#处理multipart数据">处理multipart数据</a></li>
        <li><a href="#处理异常">处理异常</a></li>
        <li><a href="#跨重定向请求传递数据">跨重定向请求传递数据</a></li>
      </ul>
    </li>
    <li><a href="#spring与数据库">Spring与数据库</a>
      <ul>
        <li><a href="#设计数据访问层的合理方式">设计数据访问层的合理方式</a></li>
        <li><a href="#配置datasource">配置DataSource</a></li>
        <li><a href="#声明式事务">声明式事务</a></li>
        <li><a href="#spring集成hibernate">Spring集成Hibernate</a></li>
        <li><a href="#spring集成原生jpa">Spring集成原生JPA</a></li>
        <li><a href="#spring-data-jpa">Spring Data JPA</a></li>
        <li><a href="#spring-data-mongodb">Spring Data MongoDB</a></li>
        <li><a href="#spring-data-redis">Spring Data Redis</a></li>
      </ul>
    </li>
    <li><a href="#spring缓存">Spring缓存</a>
      <ul>
        <li><a href="#缓存管理器">缓存管理器</a></li>
        <li><a href="#为方法添加注解以支持缓存">为方法添加注解以支持缓存</a></li>
        <li><a href="#自定义缓存key">自定义缓存key</a></li>
        <li><a href="#使用redis缓存">使用Redis缓存</a></li>
      </ul>
    </li>
    <li><a href="#spring与远程服务">Spring与远程服务</a>
      <ul>
        <li><a href="#spring集成rmi">Spring集成RMI</a></li>
      </ul>
    </li>
    <li><a href="#spring-jms">Spring JMS</a>
      <ul>
        <li><a href="#队列模式">队列模式</a></li>
        <li><a href="#发布订阅模式">发布/订阅模式</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h2 id="bean的生命周期">Bean的生命周期</h2>
<p><img src="images/%E3%80%8ASpring%20%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0-1.png" alt="《Spring 实战》笔记-1.png"></p>
<h2 id="spring-bean">Spring Bean</h2>
<h3 id="装配bean">装配Bean</h3>
<h4 id="隐式自动装配">隐式自动装配</h4>
<h5 id="基于annotation方式">基于annotation方式</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@ComponentScan</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfig</span> <span class="o">{}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="基于xml方式">基于XML方式</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">   <span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
  <span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
         <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
         <span class="na">xmlns:aop=</span><span class="s">&#34;http://www.springframework.org/schema/aop&#34;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans
</span><span class="s">             http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
</span><span class="s">             http://www.springframework.org/schema/context
</span><span class="s">             http://www.springframework.org/schema/context/spring-context-2.5.xsd
</span><span class="s">             &#34;</span><span class="nt">&gt;</span>
             
      <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com&#34;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/beans&gt;</span>   
</code></pre></td></tr></table>
</div>
</div><h4 id="显式装配">显式装配</h4>
<h5 id="基于annotation方式-1">基于annotation方式</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfig</span> <span class="o">{</span>
      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">Compactdisc</span> <span class="nf">sgtPeppers</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="k">new</span> <span class="n">SgtPeppers</span><span class="o">();</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="基于xml方式-1">基于XML方式</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
  <span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
         <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
         <span class="na">xmlns:aop=</span><span class="s">&#34;http://www.springframework.org/schema/aop&#34;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans
</span><span class="s">             http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
</span><span class="s">             http://www.springframework.org/schema/context
</span><span class="s">             http://www.springframework.org/schema/context/spring-context-2.5.xsd
</span><span class="s">             &#34;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;compactDisc&#34;</span> <span class="na">class=</span><span class="s">&#34;SgtPeppers&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
  <span class="nt">&lt;/beans&gt;</span>   
</code></pre></td></tr></table>
</div>
</div><h3 id="依赖注入">依赖注入</h3>
<h4 id="基于annotation方式-2">基于annotation方式</h4>
<h5 id="构造器注入">构造器注入</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Component</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">CDPlayer</span> <span class="o">{</span>
      <span class="kd">private</span> <span class="n">CompactDisc</span> <span class="n">cd</span><span class="o">;</span>
      <span class="nd">@Autowired</span>
      <span class="kd">public</span> <span class="nf">CDPlayer</span><span class="o">(</span><span class="n">CompactDisc</span> <span class="n">cd</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">cd</span> <span class="o">=</span> <span class="n">cd</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="属性注入">属性注入</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Component</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">CDPlayer</span> <span class="o">{</span>
      <span class="nd">@Autowired</span>
      <span class="kd">private</span> <span class="n">CompactDisc</span> <span class="n">cd</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="set方法注入">set方法注入</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">    <span class="nd">@Component</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">CDPlayer</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">CompactDisc</span> <span class="n">cd</span><span class="o">;</span>
        <span class="nd">@Autowired</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCd</span><span class="o">(</span><span class="n">CompactDisc</span> <span class="n">cd</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">cd</span> <span class="o">=</span> <span class="n">cd</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="基于xml方式-2">基于XML方式</h4>
<h5 id="构造器注入-1">构造器注入</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;compactDisc&#34;</span> <span class="na">class=</span><span class="s">&#34;SgtPeppers&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">ref=</span><span class="s">&#34;compactDisc&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;propertity</span> <span class="na">name=</span><span class="s">&#34;compactDisc&#34;</span> <span class="na">ref=</span><span class="s">&#34;compactDisc&#34;</span><span class="nt">&gt;&lt;/propertity&gt;</span>
  <span class="nt">&lt;/bean&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="属性注入-1">属性注入</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;compactDisc&#34;</span> <span class="na">class=</span><span class="s">&#34;SgtPeppers&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;propertity</span> <span class="na">name=</span><span class="s">&#34;compactDisc&#34;</span> <span class="na">ref=</span><span class="s">&#34;compactDisc&#34;</span><span class="nt">&gt;&lt;/propertity&gt;</span>
  <span class="nt">&lt;/bean&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="注入外部的值">注入外部的值</h3>
<h4 id="基于annotation方式-3">基于annotation方式</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@PropertitySource</span><span class="o">(</span><span class="s">&#34;classpath:/com/soundsystem/app.propertities&#34;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfig</span> <span class="o">{</span>
      <span class="nd">@Autowired</span>
      <span class="n">Environment</span> <span class="n">env</span><span class="o">;</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">BlankDisc</span> <span class="nf">blankDisc</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="k">new</span> <span class="n">BlankDisc</span><span class="o">(</span><span class="n">env</span><span class="o">.</span><span class="na">getPropertity</span><span class="o">(</span><span class="s">&#34;disc.title&#34;</span><span class="o">),</span> <span class="n">env</span><span class="o">.</span><span class="na">getPropertity</span><span class="o">(</span><span class="s">&#34;disc.artist&#34;</span><span class="o">));</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="基于xml方式-3">基于XML方式</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
  <span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
         <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
         <span class="na">xmlns:aop=</span><span class="s">&#34;http://www.springframework.org/schema/aop&#34;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans
</span><span class="s">             http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
</span><span class="s">             http://www.springframework.org/schema/context
</span><span class="s">             http://www.springframework.org/schema/context/spring-context-2.5.xsd
</span><span class="s">             &#34;</span><span class="nt">&gt;</span>
             <span class="nt">&lt;context:propertyplaceholder</span> <span class="na">location=</span><span class="s">&#34;classpath:/com/soundsystem/app.propertities&#34;</span><span class="nt">/&gt;</span>
             <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;sgtPetters&#34;</span>
                   <span class="na">class=</span><span class="s">&#34;BlankDisc&#34;</span>
                   <span class="na">c:_title=</span><span class="s">&#34;${disc.title}&#34;</span>
                   <span class="na">c:_title=</span><span class="s">&#34;${disc.artist}&#34;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/beans&gt;</span>   
</code></pre></td></tr></table>
</div>
</div><h3 id="bean的作用域">Bean的作用域</h3>
<h4 id="单例singleton在整个应用中只创建bean的一个实例">单例（Singleton）：在整个应用中，只创建bean的一个实例</h4>
<h5 id="基于annotation方式配置">基于annotation方式配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Component</span>
  <span class="nd">@Scope</span><span class="o">(</span><span class="n">ConfigurableBeanFactory</span><span class="o">.</span><span class="na">SCOPE_SINGLETON</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">CDPlayer</span> <span class="o">{}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="基于xml方式配置">基于XML方式配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;cDPlayer&#34;</span> <span class="na">class=</span><span class="s">&#34;CDPlayer&#34;</span> <span class="na">scope=</span><span class="s">&#34;singleton&#34;</span><span class="nt">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="原型prototype每次注入或者通过spring应用上下文获取的时候都会创建一个新的bean实例">原型（Prototype）：每次注入或者通过Spring应用上下文获取的时候，都会创建一个新的bean实例。</h4>
<h5 id="基于annotation方式配置-1">基于annotation方式配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Component</span>
  <span class="nd">@Scope</span><span class="o">(</span><span class="n">ConfigurableBeanFactory</span><span class="o">.</span><span class="na">SCOPE_PROTOTYPE</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">CDPlayer</span> <span class="o">{}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="基于xml方式配置-1">基于XML方式配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;cDPlayer&#34;</span> <span class="na">class=</span><span class="s">&#34;CDPlayer&#34;</span> <span class="na">scope=</span><span class="s">&#34;prototype&#34;</span><span class="nt">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="会话session在web应用中为每个会话创建一个bean实例">会话（Session）：在Web应用中，为每个会话创建一个bean实例。</h4>
<h5 id="基于annotation方式配置-2">基于annotation方式配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Component</span>
  <span class="nd">@Scope</span><span class="o">(</span><span class="n">WebApplicationContext</span><span class="o">.</span><span class="na">SCOPE_SESSION</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">CDPlayer</span> <span class="o">{}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="基于xml方式配置-2">基于XML方式配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;cDPlayer&#34;</span> <span class="na">class=</span><span class="s">&#34;CDPlayer&#34;</span> <span class="na">scope=</span><span class="s">&#34;session&#34;</span><span class="nt">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="请求rquest在web应用中为每个请求创建一个bean实例">请求（Rquest）：在Web应用中，为每个请求创建一个bean实例。</h4>
<h5 id="基于annotation方式配置-3">基于annotation方式配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Component</span>
  <span class="nd">@Scope</span><span class="o">(</span><span class="n">WebApplicationContext</span><span class="o">.</span><span class="na">SCOPE_REQUEST</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">CDPlayer</span> <span class="o">{}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="基于xml方式配置-3">基于XML方式配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;cDPlayer&#34;</span> <span class="na">class=</span><span class="s">&#34;CDPlayer&#34;</span> <span class="na">scope=</span><span class="s">&#34;request&#34;</span><span class="nt">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="面向切面编程aop">面向切面编程（AOP）</h2>
<h3 id="启用aop功能">启用AOP功能</h3>
<h4 id="基于annotation方式-4">基于annotation方式</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@EnableAspectJAutoProxy</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfig</span> <span class="o">{}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="基于xml方式-4">基于XML方式</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">   <span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
  <span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
         <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
         <span class="na">xmlns:aop=</span><span class="s">&#34;http://www.springframework.org/schema/aop&#34;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans
</span><span class="s">             http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
</span><span class="s">             http://www.springframework.org/schema/context
</span><span class="s">             http://www.springframework.org/schema/context/spring-context-2.5.xsd
</span><span class="s">             http://www.springframework.org/schema/aop            
</span><span class="s">             http://www.springframework.org/schema/aop/spring-aop-3.1.xsd  
</span><span class="s">             &#34;</span><span class="nt">&gt;</span>
             
      <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com&#34;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;aop:aspectj-autoproxy/&gt;</span><span class="c">&lt;!--启用AOP--&gt;</span>
  <span class="nt">&lt;/beans&gt;</span>   
</code></pre></td></tr></table>
</div>
</div><h3 id="aop代理">AOP代理</h3>
<h4 id="概念">概念</h4>
<blockquote>
<p>Spring缺省使用J2SE动态代理来作为AOP的代理。这样任何接口（或者接口集）都可以被代理。如果一个业务对象并没有实现一个接口，默认就会使用CGLIB。作为面向接口编程的最佳实践，业务对象通常都会实现一个或多个接口。</p>
</blockquote>
<h4 id="强制使用cglib代理基于annotation方式">强制使用CGLIB代理，基于annotation方式</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@EnableAspectJAutoProxy</span><span class="o">(</span><span class="n">proxyTargetClass</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfig</span> <span class="o">{}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="强制使用cglib代理基于xml方式">强制使用CGLIB代理，基于XML方式</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;aop:aspectj-autoproxy</span> <span class="na">proxy-target-class=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="切面">切面</h3>
<h4 id="声明切面基于annotation方式">声明切面，基于annotation方式</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Component</span>
<span class="nd">@Aspect</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Audience</span> <span class="o">{}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="声明切面基于xml方式">声明切面，基于XML方式</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;aop:config&gt;</span>
    <span class="nt">&lt;aop:aspect</span> <span class="na">ref=</span><span class="s">&#34;audience&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/aop:aspect&gt;</span>
  <span class="nt">&lt;/aop:config&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="切点">切点</h3>
<h4 id="声明切点基于annotation方式">声明切点，基于annotation方式</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Pointcut</span><span class="err">（</span><span class="s">&#34;execution（* transfer（..））&#34;</span><span class="err">）</span>
  <span class="kd">private</span> <span class="kt">void</span> <span class="n">anyOldTransfer</span><span class="err">（）</span> <span class="o">{}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="声明切点基于xml方式">声明切点，基于XML方式</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;aop:config&gt;</span>
    <span class="nt">&lt;aop:pointcut</span> <span class="na">id=</span><span class="s">&#34;anyOldTransfer&#34;</span> <span class="na">expression=</span><span class="s">&#34;execution（* transfer（..））&#34;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/aop:config&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="切点指示器">切点指示器</h4>
<blockquote>
<p>Spring AOP支持在切入点表达式中使用如下的AspectJ切入点指示符：
execution - 匹配方法执行的连接点，这是你将会用到的Spring的最主要的切入点指示符。
within - 限定匹配特定类型的连接点（在使用Spring AOP的时候，在匹配的类型中定义的方法的执行）。
this - 限定匹配特定的连接点（使用Spring AOP的时候方法的执行），其中bean reference（Spring AOP 代理）是指定类型的实例。
target - 限定匹配特定的连接点（使用Spring AOP的时候方法的执行），其中目标对象（被代理的应用对象）是指定类型的实例。
args - 限定匹配特定的连接点（使用Spring AOP的时候方法的执行），其中参数是指定类型的实例。
@target - 限定匹配特定的连接点（使用Spring AOP的时候方法的执行），其中正执行对象的类持有指定类型的注解。
@args - 限定匹配特定的连接点（使用Spring AOP的时候方法的执行），其中实际传入参数的运行时类型持有指定类型的注解。
@within - 限定匹配特定的连接点，其中连接点所在类型已指定注解（在使用Spring AOP的时候，所执行的方法所在类型已指定注解）。
@annotation - 限定匹配特定的连接点（使用Spring AOP的时候方法的执行），其中连接点的主题持有指定的注解。</p>
</blockquote>
<h3 id="通知">通知</h3>
<h4 id="声明通知基于annotation方式">声明通知，基于annotation方式</h4>
<h5 id="前置通知">前置通知</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Before</span><span class="err">（</span><span class="s">&#34;beforePointcut（）&#34;</span><span class="err">）</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">before</span><span class="err">（）</span> <span class="o">{</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="后置通知">后置通知</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@AfterReturning</span><span class="err">（</span><span class="n">pointcut</span><span class="o">=</span><span class="s">&#34;afterReturningPointcut（）&#34;</span><span class="o">,</span> <span class="n">returning</span><span class="o">=</span><span class="s">&#34;retVal&#34;</span><span class="err">）</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">afterReturning</span><span class="err">（</span><span class="n">Object</span> <span class="n">retVal</span><span class="err">）</span> <span class="o">{</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="异常通知">异常通知</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@AfterThrowing</span><span class="err">（</span><span class="n">pointcut</span><span class="o">=</span><span class="s">&#34;throwingPointcut（）&#34;</span><span class="o">,</span> <span class="n">throwing</span><span class="o">=</span><span class="s">&#34;ex&#34;</span><span class="err">）</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">throwing</span><span class="err">（</span><span class="n">Exception</span> <span class="n">ex</span><span class="err">）</span> <span class="o">{</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="最终通知">最终通知</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@After</span><span class="err">（</span><span class="s">&#34;afterPointcut（）&#34;</span><span class="err">）</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">after</span><span class="err">（）</span> <span class="o">{</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="环绕通知">环绕通知</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Around</span><span class="err">（</span><span class="s">&#34;aroundPointcut（）&#34;</span><span class="err">）</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="n">around</span><span class="err">（</span><span class="n">ProceedingJoinPoint</span> <span class="n">pjp</span><span class="err">）</span> <span class="o">{</span>
    <span class="n">Object</span> <span class="n">retVal</span> <span class="o">=</span> <span class="n">pjp</span><span class="o">.</span><span class="na">proceed</span><span class="err">（）</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">retVal</span><span class="o">;</span>
  <span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="声明通知基于xml方式">声明通知，基于XML方式</h4>
<h5 id="前置通知-1">前置通知</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;aop:aspect</span> <span class="na">id=</span><span class="s">&#34;beforeExample&#34;</span> <span class="na">ref=</span><span class="s">&#34;aBean&#34;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;aop:before</span> 
        <span class="na">pointcut-ref=</span><span class="s">&#34;beforePointcut&#34;</span> 
        <span class="na">method=</span><span class="s">&#34;before&#34;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/aop:aspect&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="后置通知-1">后置通知</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;aop:aspect</span> <span class="na">id=</span><span class="s">&#34;afterReturningExample&#34;</span> <span class="na">ref=</span><span class="s">&#34;aBean&#34;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;aop:after-returning</span> 
        <span class="na">pointcut-ref=</span><span class="s">&#34;afterReturning&#34;</span> 
        <span class="na">method=</span><span class="s">&#34;afterReturning&#34;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/aop:aspect&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="异常通知-1">异常通知</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;aop:aspect</span> <span class="na">id=</span><span class="s">&#34;afterThrowingExample&#34;</span> <span class="na">ref=</span><span class="s">&#34;aBean&#34;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;aop:after-throwing</span> 
        <span class="na">pointcut-ref=</span><span class="s">&#34;throwingPointcut&#34;</span>
        <span class="na">throwing=</span><span class="s">&#34;ex&#34;</span> 
        <span class="na">method=</span><span class="s">&#34;throwing&#34;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/aop:aspect&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="最终通知-1">最终通知</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;aop:aspect</span> <span class="na">id=</span><span class="s">&#34;afterFinallyExample&#34;</span> <span class="na">ref=</span><span class="s">&#34;aBean&#34;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;aop:after</span>
        <span class="na">pointcut-ref=</span><span class="s">&#34;afterPointcut&#34;</span> 
        <span class="na">method=</span><span class="s">&#34;after&#34;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/aop:aspect&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="环绕通知-1">环绕通知</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;aop:aspect</span> <span class="na">id=</span><span class="s">&#34;aroundExample&#34;</span> <span class="na">ref=</span><span class="s">&#34;aBean&#34;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;aop:around</span>
        <span class="na">pointcut-ref=</span><span class="s">&#34;aroundPointcut&#34;</span> 
        <span class="na">method=</span><span class="s">&#34;around&#34;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/aop:aspect&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="spring-mvc">Spring MVC</h2>
<h3 id="跟踪spring-mvc的请求">跟踪Spring MVC的请求</h3>
<p><img src="images/%E3%80%8ASpring%20%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0-2.png" alt="《Spring 实战》笔记-2.png"></p>
<h3 id="spring-mvc配置">Spring MVC配置</h3>
<h4 id="基于java配置方式">基于Java配置方式</h4>
<h5 id="配置dispatcherservlet">配置DispatcherServlet</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">DispatcherServlet</span> <span class="kd">extends</span> <span class="n">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="o">{</span>
      <span class="nd">@Override</span>
      <span class="kd">protected</span> <span class="n">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">getRootConfigClasses</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="k">new</span> <span class="n">Class</span><span class="o">[]{</span><span class="n">SpringConfig</span><span class="o">.</span><span class="na">class</span><span class="o">};</span>
      <span class="o">}</span>
      <span class="nd">@Override</span>
      <span class="kd">protected</span> <span class="n">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">getServletConfigClasses</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="k">new</span> <span class="n">Class</span><span class="o">&lt;?&gt;[]{</span><span class="n">SpringMvcConfig</span><span class="o">.</span><span class="na">class</span><span class="o">};</span>
      <span class="o">}</span>
      <span class="nd">@Override</span>
      <span class="kd">protected</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">getServletMappings</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;/&#34;</span><span class="o">};</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>工作原理：</p>
<blockquote>
<p>在Servlet 3.0环境中，容器会在类路径中查找实现javax.servlet.ServletContainerInitializer接口的类，如果能发现的话，就会用它来配置Servlet容器。Spring提供了这个接口的实现，名为SpringServletContainerInitializer，这个类反过来又会查找实现WebApplicationInitializer的类并将配置的任务交给它们来完成。Spring 3.2引入了一个便利的WebApplicationInitializer基础实现，也就是AbstractAnnotationConfigDispatcherServletInitializer因为我们的DispatcherServlet扩展了AbstractAnnotationConfigDispatcherServlet-Initializer（同时也就实现了WebApplicationInitializer），因此当部署到Servlet 3.0容器中的时候，容器会自动发现它，并用它来配置Servlet上下文。</p>
</blockquote>
<h5 id="spring-mvc配置-1">Spring MVC配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@EnableWebMvc</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringMvcConfig</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span> <span class="o">{</span>
      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">ViewResolver</span> <span class="nf">viewResolver</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">InternalResourceViewResolver</span> <span class="n">vr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InternalResourceViewResolver</span><span class="o">();</span>
          <span class="n">vr</span><span class="o">.</span><span class="na">setPrefix</span><span class="o">(</span><span class="s">&#34;/WEB-INF/&#34;</span><span class="o">);</span>
          <span class="n">vr</span><span class="o">.</span><span class="na">setSuffix</span><span class="o">(</span><span class="s">&#34;.jsp&#34;</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">vr</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureDefaultServletHandling</span><span class="o">(</span><span class="n">DefaultServletHandlerConfigurer</span> <span class="n">configurer</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">configurer</span><span class="o">.</span><span class="na">enable</span><span class="o">();</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@ComponentScan</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>SpringMvcConfig扩展了WebMvcConfigurerAdapter并重写了其configureDefaultServletHandling()方法。通过调用DefaultServletHandlerConfigurer的enable()方法，我们要求DispatcherServlet将对静态资源的请求转发到Servlet容器中默认的Servlet上，而不是使用DispatcherServlet本身来处理此类请求。</p>
</blockquote>
<h4 id="基于xml配置方式">基于XML配置方式</h4>
<h5 id="配置dispatcherservlet-1">配置DispatcherServlet</h5>
<p>web.xml</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;web-app</span> <span class="na">xmlns=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span>
           <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
           <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee
</span><span class="s">                   http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&#34;</span>
           <span class="na">version=</span><span class="s">&#34;3.1&#34;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;context-param&gt;</span>
          <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
          <span class="nt">&lt;param-value&gt;</span>classpath:context.xml<span class="nt">&lt;/param-value&gt;</span>
      <span class="nt">&lt;/context-param&gt;</span>
      <span class="nt">&lt;listener&gt;</span>
          <span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="nt">&lt;/listener-class&gt;</span>
      <span class="nt">&lt;/listener&gt;</span>
      <span class="nt">&lt;servlet&gt;</span>
          <span class="nt">&lt;servlet-name&gt;</span>dispatcherServlet<span class="nt">&lt;/servlet-name&gt;</span>
          <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
          <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
      <span class="nt">&lt;/servlet&gt;</span>
      <span class="nt">&lt;servlet-mapping&gt;</span>
          <span class="nt">&lt;servlet-name&gt;</span>dispatcherServlet<span class="nt">&lt;/servlet-name&gt;</span>
          <span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
      <span class="nt">&lt;/servlet-mapping&gt;</span>
  <span class="nt">&lt;/web-app&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="spring-mvc配置-2">Spring MVC配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
  <span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
         <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
         <span class="na">xmlns:mvc=</span><span class="s">&#34;http://www.springframework.org/schema/mvc&#34;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;
</span><span class="s">         http://www.springframework.org/schema/beans
</span><span class="s">         http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">         http://www.springframework.org/schema/context
</span><span class="s">         http://www.springframework.org/schema/context/spring-context.xsd
</span><span class="s">         http://www.springframework.org/schema/mvc
</span><span class="s">         http://www.springframework.org/schema/mvc/spring-mvc.xsd
</span><span class="s">         &#34;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com&#34;</span><span class="nt">/&gt;</span>
         <span class="c">&lt;!--将对静态资源的请求转发到Servlet容器中默认的Servlet上，而不是使用DispatcherServlet本身来处理此类请求--&gt;</span>
         <span class="nt">&lt;mvc:default-servlet-handler</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;mvc:annotation-driven</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.view.InternalResourceViewResolver&#34;</span>
               <span class="na">id=</span><span class="s">&#34;internalResourceViewResolver&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;prefix&#34;</span> <span class="na">value=</span><span class="s">&#34;/WEB-INF/jsp/&#34;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suffix&#34;</span> <span class="na">value=</span><span class="s">&#34;.jsp&#34;</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;/bean&gt;</span>
  <span class="nt">&lt;/beans&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="处理请求参数">处理请求参数</h3>
<h4 id="处理查询参数">处理查询参数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Controller</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>
      <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/test&#34;</span><span class="o">)</span>
      <span class="kd">public</span> <span class="n">String</span> <span class="nf">test</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="s">&#34;test&#34;</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="处理路径参数">处理路径参数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Controller</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>
      <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/test/{name}&#34;</span><span class="o">)</span>
      <span class="kd">public</span> <span class="n">String</span> <span class="nf">test</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="s">&#34;test&#34;</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="处理表单参数">处理表单参数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Controller</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>
      <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/test&#34;</span><span class="o">)</span>
      <span class="kd">public</span> <span class="n">String</span> <span class="nf">test</span><span class="o">(</span><span class="nd">@Valid</span> <span class="n">Form</span> <span class="n">form</span><span class="o">,</span> <span class="n">Errors</span> <span class="n">errors</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">if</span><span class="o">(</span><span class="n">errors</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span>
              <span class="k">return</span> <span class="s">&#34;error&#34;</span><span class="o">;</span>
          
          <span class="k">return</span> <span class="s">&#34;test&#34;</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Form</span> <span class="o">{</span>
      <span class="nd">@NotNull</span>
      <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

      <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Java校验API所提供的校验注解</p>
<table>
<thead>
<tr>
<th style="text-align:center">注解</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">@AssertFalse</td>
<td style="text-align:center">所注解的元素必须是Boolean类型，并且值为 false</td>
</tr>
<tr>
<td style="text-align:center">@AssertTrue</td>
<td style="text-align:center">所注解的元素必须是Boolean类型，并且值为 true</td>
</tr>
<tr>
<td style="text-align:center">@DecimalMa</td>
<td style="text-align:center">所注解的元素必须是数字，并且它的值要小于或等于给定的BigDecimalString 值</td>
</tr>
<tr>
<td style="text-align:center">@DecimalMi</td>
<td style="text-align:center">所注解的元素必须是数字，并且它的值要大于或等于给定的BigDecimalString 值</td>
</tr>
<tr>
<td style="text-align:center">@Digits</td>
<td style="text-align:center">所注解的元素必须是数字，并且它的值必须有指定的位数</td>
</tr>
<tr>
<td style="text-align:center">@Future</td>
<td style="text-align:center">所注解的元素的值必须是一个将来的日期</td>
</tr>
<tr>
<td style="text-align:center">@Max</td>
<td style="text-align:center">所注解的元素必须是数字，并且它的值要小于或等于给定的值</td>
</tr>
<tr>
<td style="text-align:center">@Min</td>
<td style="text-align:center">所注解的元素必须是数字，并且它的值要大于或等于给定的值</td>
</tr>
<tr>
<td style="text-align:center">@NotNull</td>
<td style="text-align:center">所注解元素的值必须不能为 null</td>
</tr>
<tr>
<td style="text-align:center">@Null</td>
<td style="text-align:center">所注解元素的值必须为 null</td>
</tr>
<tr>
<td style="text-align:center">@Past</td>
<td style="text-align:center">所注解的元素的值必须是一个已过去的日期</td>
</tr>
<tr>
<td style="text-align:center">@Pattern</td>
<td style="text-align:center">所注解的元素的值必须匹配给定的正则表达式</td>
</tr>
<tr>
<td style="text-align:center">@Siz</td>
<td style="text-align:center">所注解的元素的值必须是 String 、集合或数组，并且它的长度要符合给定的范围</td>
</tr>
</tbody>
</table>
<h3 id="渲染web视图">渲染Web视图</h3>
<h4 id="视图解析器">视图解析器</h4>
<p>Spring自带了13个视图解析器，能够将逻辑视图名转换为物理实现。Spring 4和Spring 3.2支持表6.1中的所有视图解析器。Spring 3.1支持除Tiles 3 TilesViewResolver之外的所有视图解析器</p>
<table>
<thead>
<tr>
<th style="text-align:center">视图解析器</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">BeanNameViewResolver</td>
<td style="text-align:center">将视图解析为Spring应用上下文中的bean，其中bean的ID与视图的名字相同</td>
</tr>
<tr>
<td style="text-align:center">ContentNegotiatingViewResolver</td>
<td style="text-align:center">通过考虑客户端需要的内容类型来解析视图，委托给另外一个能够产生对应内容类型的视图解析器</td>
</tr>
<tr>
<td style="text-align:center">FreeMarkerViewResolver</td>
<td style="text-align:center">将视图解析为FreeMarker模板</td>
</tr>
<tr>
<td style="text-align:center">InternalResourceViewResolver</td>
<td style="text-align:center">将视图解析为Web应用的内部资源（一般为JSP）</td>
</tr>
<tr>
<td style="text-align:center">JasperReportsViewResolver</td>
<td style="text-align:center">将视图解析为JasperReports定义</td>
</tr>
<tr>
<td style="text-align:center">ResourceBundleViewResolver</td>
<td style="text-align:center">将视图解析为资源bundle（一般为属性文件）</td>
</tr>
<tr>
<td style="text-align:center">TilesViewResolver</td>
<td style="text-align:center">将视图解析为Apache Tile定义，其中tile ID与视图名称相同。注意有两个不同的</td>
</tr>
<tr>
<td style="text-align:center">TilesViewResolver</td>
<td style="text-align:center">实现，分别对应于Tiles 2.0和Tiles 3.0</td>
</tr>
<tr>
<td style="text-align:center">UrlBasedViewResolver</td>
<td style="text-align:center">直接根据视图的名称解析视图，视图的名称会匹配一个物理视图的定义</td>
</tr>
<tr>
<td style="text-align:center">VelocityLayoutViewResolver</td>
<td style="text-align:center">将视图解析为Velocity布局，从不同的Velocity模板中组合页面</td>
</tr>
<tr>
<td style="text-align:center">VelocityViewResolver</td>
<td style="text-align:center">将视图解析为Velocity模板</td>
</tr>
<tr>
<td style="text-align:center">XmlViewResolver</td>
<td style="text-align:center">将视图解析为特定XML文件中的bean定义。类似于 BeanName-ViewResolver</td>
</tr>
<tr>
<td style="text-align:center">XsltViewResolver</td>
<td style="text-align:center">将视图解析为XSLT转换后的结果</td>
</tr>
</tbody>
</table>
<h4 id="使用jsp视图解析器">使用JSP视图解析器</h4>
<h5 id="基于java配置方式-1">基于Java配置方式</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@EnableWebMvc</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringMvcConfig</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span> <span class="o">{</span>
      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">ViewResolver</span> <span class="nf">viewResolver</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">InternalResourceViewResolver</span> <span class="n">vr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InternalResourceViewResolver</span><span class="o">();</span>
          <span class="n">vr</span><span class="o">.</span><span class="na">setPrefix</span><span class="o">(</span><span class="s">&#34;/WEB-INF/&#34;</span><span class="o">);</span>
          <span class="n">vr</span><span class="o">.</span><span class="na">setSuffix</span><span class="o">(</span><span class="s">&#34;.jsp&#34;</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">vr</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="基于xml配置方式-1">基于XML配置方式</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.view.InternalResourceViewResolver&#34;</span> <span class="na">id=</span><span class="s">&#34;internalResourceViewResolver&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;prefix&#34;</span> <span class="na">value=</span><span class="s">&#34;/WEB-INF/jsp/&#34;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suffix&#34;</span> <span class="na">value=</span><span class="s">&#34;.jsp&#34;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/bean&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="使用thymeleaf视图解析器">使用Thymeleaf视图解析器</h4>
<h5 id="基于java配置方式-2">基于Java配置方式</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@EnableWebMvc</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringMvcConfig</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span> <span class="o">{</span>
      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">ViewResolver</span> <span class="nf">viewResolver</span><span class="o">(</span><span class="n">SpringTemplateEngine</span> <span class="n">templateEngine</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">ThymeleafViewResolver</span> <span class="n">vr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ThymeleafViewResolver</span><span class="o">();</span>
          <span class="n">vr</span><span class="o">.</span><span class="na">setTemplateEngine</span><span class="o">(</span><span class="n">templateEngine</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">vr</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">SpringTemplateEngine</span> <span class="nf">templateEngine</span><span class="o">(</span><span class="n">TemplateResolver</span> <span class="n">templateResolver</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">SpringTemplateEngine</span> <span class="n">templateEngine</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpringTemplateEngine</span><span class="o">();</span>
          <span class="n">templateEngine</span><span class="o">.</span><span class="na">setTemplateResolver</span><span class="o">(</span><span class="n">templateResolver</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">templateEngine</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">TemplateResolver</span> <span class="nf">templateResolver</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">TemplateResolver</span> <span class="n">templateResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServletContextTemplateResolver</span><span class="o">();</span>
          <span class="n">templateResolver</span><span class="o">.</span><span class="na">setPrefix</span><span class="o">(</span><span class="s">&#34;/WEB-INF/&#34;</span><span class="o">);</span>
          <span class="n">templateResolver</span><span class="o">.</span><span class="na">setSuffix</span><span class="o">(</span><span class="s">&#34;.html&#34;</span><span class="o">);</span>
          <span class="n">templateResolver</span><span class="o">.</span><span class="na">setTemplateMode</span><span class="o">(</span><span class="s">&#34;HTML5&#34;</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">templateResolver</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="基于xml配置方式-2">基于XML配置方式</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
  <span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
         <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
         <span class="na">xmlns:mvc=</span><span class="s">&#34;http://www.springframework.org/schema/mvc&#34;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;
</span><span class="s">         http://www.springframework.org/schema/beans
</span><span class="s">         http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">         http://www.springframework.org/schema/context
</span><span class="s">         http://www.springframework.org/schema/context/spring-context.xsd
</span><span class="s">         http://www.springframework.org/schema/mvc
</span><span class="s">         http://www.springframework.org/schema/mvc/spring-mvc.xsd
</span><span class="s">         &#34;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;mvc:default-servlet-handler</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;mvc:annotation-driven</span> <span class="nt">/&gt;</span>
         <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.thymeleaf.spring4.view.ThymeleafViewResolver&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;templateEngine&#34;</span> <span class="na">ref=</span><span class="s">&#34;templateEngine&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/bean&gt;</span>
         <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;templateEngine&#34;</span> <span class="na">class=</span><span class="s">&#34;org.thymeleaf.spring4.SpringTemplateEngine&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;templateResolver&#34;</span> <span class="na">ref=</span><span class="s">&#34;templateResolver&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/bean&gt;</span>
         <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;templateResolver&#34;</span> <span class="na">class=</span><span class="s">&#34;org.thymeleaf.templateresolver.ServletContextTemplateResolver&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;prefix&#34;</span> <span class="na">value=</span><span class="s">&#34;/WEB-INF/&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suffix&#34;</span> <span class="na">value=</span><span class="s">&#34;.html&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;templateMode&#34;</span> <span class="na">value=</span><span class="s">&#34;HTML5&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/bean&gt;</span>
  <span class="nt">&lt;/beans&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="spring-jsp标签库">Spring JSP标签库</h4>
<h5 id="spring表单标签库">Spring表单标签库</h5>
<p>&lt;%@ taglib prefix=&ldquo;sf&rdquo; uri=&ldquo;<a href="http://www.springframework.org/tags/form%22%25%3E">http://www.springframework.org/tags/form&quot;%&gt;</a></p>
<table>
<thead>
<tr>
<th style="text-align:center">JSP标签</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a href="sf:checkbox">sf:checkbox</a></td>
<td style="text-align:center">渲染成一个HTML &lt;input&gt; 标签，其中 type 属性设置为 checkbox</td>
</tr>
<tr>
<td style="text-align:center"><a href="sf:checkboxes">sf:checkboxes</a></td>
<td style="text-align:center">渲染成多个HTML &lt;input&gt; 标签，其中 type 属性设置为 checkbox</td>
</tr>
<tr>
<td style="text-align:center"><a href="sf:errors">sf:errors</a></td>
<td style="text-align:center">在一个HTML &lt;span&gt; 中渲染输入域的错误</td>
</tr>
<tr>
<td style="text-align:center"><a href="sf:form">sf:form</a></td>
<td style="text-align:center">渲染成一个HTML &lt;form&gt; 标签，并为其内部标签暴露绑定路径，用于数据绑定</td>
</tr>
<tr>
<td style="text-align:center"><a href="sf:hidden">sf:hidden</a></td>
<td style="text-align:center">渲染成一个HTML &lt;input&gt; 标签，其中 type 属性设置为 hidden</td>
</tr>
<tr>
<td style="text-align:center"><a href="sf:input">sf:input</a></td>
<td style="text-align:center">渲染成一个HTML &lt;input&gt; 标签，其中 type 属性设置为 text</td>
</tr>
<tr>
<td style="text-align:center"><a href="sf:label">sf:label</a></td>
<td style="text-align:center">渲染成一个HTML &lt;label&gt; 标签</td>
</tr>
<tr>
<td style="text-align:center"><a href="sf:option">sf:option</a></td>
<td style="text-align:center">渲染成一个HTML &lt;option&gt; 标签，其 selected 属性根据所绑定的值进行设置</td>
</tr>
<tr>
<td style="text-align:center"><a href="sf:options">sf:options</a></td>
<td style="text-align:center">按照绑定的集合、数组或Map，渲染成一个HTML &lt;option&gt; 标签的列表</td>
</tr>
<tr>
<td style="text-align:center"><a href="sf:password">sf:password</a></td>
<td style="text-align:center">渲染成一个HTML &lt;input&gt; 标签，其中 type 属性设置为 password</td>
</tr>
<tr>
<td style="text-align:center"><a href="sf:radiobutton">sf:radiobutton</a></td>
<td style="text-align:center">渲染成一个HTML &lt;input&gt; 标签，其中 type 属性设置为 radio</td>
</tr>
<tr>
<td style="text-align:center"><a href="sf:radiobuttons">sf:radiobuttons</a></td>
<td style="text-align:center">渲染成多个HTML &lt;input&gt; 标签，其中 type 属性设置为 radio</td>
</tr>
<tr>
<td style="text-align:center"><a href="sf:select">sf:select</a></td>
<td style="text-align:center">渲染为一个HTML &lt;select&gt; 标签</td>
</tr>
<tr>
<td style="text-align:center"><a href="sf:textarea">sf:textarea</a></td>
<td style="text-align:center">渲染为一个HTML &lt;textarea&gt; 标签</td>
</tr>
</tbody>
</table>
<h5 id="spring通用标签库">Spring通用标签库</h5>
<p>&lt;%@ taglib prefix=&ldquo;s&rdquo; uri=&ldquo;<a href="http://www.springframework.org/security/tags%22">http://www.springframework.org/security/tags&quot;</a> %&gt;</p>
<table>
<thead>
<tr>
<th style="text-align:center">JSP标签</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">&lt;s:bind&gt;</td>
<td style="text-align:center">将绑定属性的状态导出到一个名为 status 的页面作用域属性中，与 &lt;s:path&gt; 组合使用获取绑定属性的值</td>
</tr>
<tr>
<td style="text-align:center">&lt;s:escapeBody&gt;</td>
<td style="text-align:center">将标签体中的内容进行HTML和/或JavaScript转义</td>
</tr>
<tr>
<td style="text-align:center">&lt;s:hasBindErrors&gt;</td>
<td style="text-align:center">根据指定模型对象（在请求属性中）是否有绑定错误，有条件地渲染内容</td>
</tr>
<tr>
<td style="text-align:center">&lt;s:htmlEscape&gt;</td>
<td style="text-align:center">为当前页面设置默认的HTML转义值</td>
</tr>
<tr>
<td style="text-align:center">&lt;s:message&gt;</td>
<td style="text-align:center">根据给定的编码获取信息，然后要么进行渲染（默认行为），要么将其设置为页面作用域、请求作用域、<!-- raw HTML omitted -->会话作用域或应用作用域的变量（通过使用 var 和 scope 属性实现）</td>
</tr>
<tr>
<td style="text-align:center">&lt;s:nestedPath&gt;</td>
<td style="text-align:center">设置嵌入式的path，用于 &lt;s:bind&gt; 之中</td>
</tr>
<tr>
<td style="text-align:center">&lt;s:theme&gt;</td>
<td style="text-align:center">根据给定的编码获取主题信息，然后要么进行渲染（默认行为），要么将其设置为页面作用域、<!-- raw HTML omitted -->请求作用域、会话作用域或应用作用域的变量（通过使用 var 和 scope 属性实现）</td>
</tr>
<tr>
<td style="text-align:center">&lt;s:transform&gt;</td>
<td style="text-align:center">使用命令对象的属性编辑器转换命令对象中不包含的属性</td>
</tr>
<tr>
<td style="text-align:center">&lt;s:url&gt;</td>
<td style="text-align:center">创建相对于上下文的URL，支持URI模板变量以及HTML/XML/JavaScript转义。可以渲染URL（默认行为），<!-- raw HTML omitted -->也可以将其设置为页面作用域、请求作用域、会话作用域或应用作用域的变量（通过使用 var 和 scope 属性实现）</td>
</tr>
<tr>
<td style="text-align:center">&lt;s:eval&gt;</td>
<td style="text-align:center">计算符合Spring表达式语言（Spring Expression Language，SpEL）语法的某个表达式的值，<!-- raw HTML omitted -->然后要么进行渲染（默认行为），要么将其设置为页面作用域、请求作用域、会话作用域或应用作用域的变量<!-- raw HTML omitted -->（通过使用 var 和 scope 属性实现）</td>
</tr>
</tbody>
</table>
<h3 id="处理multipart数据">处理multipart数据</h3>
<h4 id="配置multipart解析器">配置multipart解析器</h4>
<p>Spring内置了两个MultipartResolver的实现供我们选择：</p>
<ul>
<li>CommonsMultipartResolver：使用Jakarta CommonsFileUpload解析multipart请求；</li>
<li>StandardServletMultipartResolver：依赖于Servlet 3.0对multipart请求的支持（始于Spring 3.1）。</li>
</ul>
<h5 id="commonsmultipartresolver">CommonsMultipartResolver</h5>
<h6 id="基于java配置方式-3">基于Java配置方式</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@EnableWebMvc</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringMvcConfig</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span> <span class="o">{</span>
      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">MultipartResolver</span> <span class="nf">multipartResolver</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
          <span class="n">CommonsMultipartResolver</span> <span class="n">multipartResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CommonsMultipartResolver</span><span class="o">();</span>
          <span class="n">multipartResolver</span><span class="o">.</span><span class="na">setUploadTempDir</span><span class="o">(</span><span class="k">new</span> <span class="n">FileSystemResource</span><span class="o">(</span><span class="s">&#34;/tmp&#34;</span><span class="o">));</span>
          <span class="n">multipartResolver</span><span class="o">.</span><span class="na">setMaxUploadSize</span><span class="o">(</span><span class="n">2L</span> <span class="o">*</span> <span class="n">1024L</span> <span class="o">*</span> <span class="n">1024L</span><span class="o">);</span>
          <span class="n">multipartResolver</span><span class="o">.</span><span class="na">setMaxUploadSizePerFile</span><span class="o">(</span><span class="n">1024L</span> <span class="o">*</span> <span class="n">1024L</span><span class="o">);</span>
          <span class="n">multipartResolver</span><span class="o">.</span><span class="na">setMaxInMemorySize</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">multipartResolver</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="基于xml配置方式-3">基于XML配置方式</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.multipart.commons.CommonsMultipartResolver&#34;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;uploadTempDir&#34;</span> <span class="na">ref=</span><span class="s">&#34;uploadTempDir&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;maxUploadSizePerFile&#34;</span> <span class="na">value=</span><span class="s">&#34;1048576&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;maxUploadSize&#34;</span> <span class="na">value=</span><span class="s">&#34;2097152&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;maxInMemorySize&#34;</span> <span class="na">value=</span><span class="s">&#34;0&#34;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/bean&gt;</span>
  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;uploadTempDir&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.core.io.FileSystemResource&#34;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;constructor-arg</span> <span class="na">value=</span><span class="s">&#34;/tmp&#34;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/bean&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="standardservletmultipartresolver">StandardServletMultipartResolver</h5>
<h6 id="基于java配置方式-4">基于Java配置方式</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@EnableWebMvc</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringMvcConfig</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="n">MultipartResolver</span> <span class="nf">multipartResolver</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="k">new</span> <span class="n">StandardServletMultipartResolver</span><span class="o">();</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">DispatcherServlet</span> <span class="kd">extends</span> <span class="n">AbstractAnnotationConfigDispatcherServletInitializer</span> <span class="o">{</span>
      <span class="nd">@Override</span>
      <span class="kd">protected</span> <span class="n">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">getRootConfigClasses</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="k">new</span> <span class="n">Class</span><span class="o">[]{</span><span class="n">SpringConfig</span><span class="o">.</span><span class="na">class</span><span class="o">};</span>
      <span class="o">}</span>
      <span class="nd">@Override</span>
      <span class="kd">protected</span> <span class="n">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">getServletConfigClasses</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="k">new</span> <span class="n">Class</span><span class="o">&lt;?&gt;[</span><span class="n">0</span><span class="o">];</span>
      <span class="o">}</span>
      <span class="nd">@Override</span>
      <span class="kd">protected</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">getServletMappings</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;/&#34;</span><span class="o">};</span>
      <span class="o">}</span>
      <span class="nd">@Override</span>
      <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">customizeRegistration</span><span class="o">(</span><span class="n">ServletRegistration</span><span class="o">.</span><span class="na">Dynamic</span> <span class="n">registration</span><span class="o">)</span> <span class="o">{</span>
          <span class="c1">//限制文件的大小不超过1MB，整个请求不超过2MB，而且所有的文件都要写到磁盘中
</span><span class="c1"></span>          <span class="n">registration</span><span class="o">.</span><span class="na">setMultipartConfig</span><span class="o">(</span><span class="k">new</span> <span class="n">MultipartConfigElement</span><span class="o">(</span><span class="s">&#34;/tmp&#34;</span><span class="o">,</span> <span class="n">1024L</span> <span class="o">*</span> <span class="n">1024L</span><span class="o">,</span> <span class="n">2L</span> <span class="o">*</span> <span class="n">1024L</span> <span class="o">*</span> <span class="n">1024L</span><span class="o">,</span> <span class="n">0</span><span class="o">));</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="基于xml配置方式-4">基于XML配置方式</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.multipart.support.StandardServletMultipartResolver&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;servlet&gt;</span>
      <span class="nt">&lt;servlet-name&gt;</span>dispatcherServlet<span class="nt">&lt;/servlet-name&gt;</span>
      <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
      <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
      <span class="nt">&lt;multipart-config&gt;</span>
          <span class="nt">&lt;location&gt;</span>/tmp<span class="nt">&lt;/location&gt;</span>
          <span class="nt">&lt;max-file-size&gt;</span>1048576<span class="nt">&lt;/max-file-size&gt;</span>
          <span class="nt">&lt;max-request-size&gt;</span>2097152<span class="nt">&lt;/max-request-size&gt;</span>
          <span class="nt">&lt;file-size-threshold&gt;</span>0<span class="nt">&lt;/file-size-threshold&gt;</span>
      <span class="nt">&lt;/multipart-config&gt;</span>
  <span class="nt">&lt;/servlet&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="处理multipart请求">处理multipart请求</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Controller</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>
      <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/test&#34;</span><span class="o">)</span>
      <span class="kd">public</span> <span class="n">String</span> <span class="nf">test</span><span class="o">(</span><span class="n">MultipartFile</span> <span class="n">multipartFile</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
          <span class="n">FileCopyUtils</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">multipartFile</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">(),</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="s">&#34;/tmp/&#34;</span> <span class="o">+</span> <span class="n">multipartFile</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">()));</span>
          <span class="k">return</span> <span class="s">&#34;test&#34;</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="处理异常">处理异常</h3>
<p>Spring提供了多种方式将异常转换为响应：</p>
<h4 id="一特定的spring异常将会自动映射为指定的http状态码">一、特定的Spring异常将会自动映射为指定的HTTP状态码；</h4>
<table>
<thead>
<tr>
<th style="text-align:center">Spring异常</th>
<th style="text-align:center">HTTP状态码</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">BindException</td>
<td style="text-align:center">400 - Bad Request</td>
</tr>
<tr>
<td style="text-align:center">ConversionNotSupportedException</td>
<td style="text-align:center">500 - Internal Server Error</td>
</tr>
<tr>
<td style="text-align:center">HttpMediaTypeNotAcceptableException</td>
<td style="text-align:center">406 - Not Acceptable</td>
</tr>
<tr>
<td style="text-align:center">HttpMediaTypeNotSupportedException</td>
<td style="text-align:center">415 - Unsupported Media Type</td>
</tr>
<tr>
<td style="text-align:center">HttpMessageNotReadableException</td>
<td style="text-align:center">400 - Bad Request</td>
</tr>
<tr>
<td style="text-align:center">HttpMessageNotWritableException</td>
<td style="text-align:center">500 - Internal Server Error</td>
</tr>
<tr>
<td style="text-align:center">HttpRequestMethodNotSupportedException</td>
<td style="text-align:center">405 - Method Not Allowed</td>
</tr>
<tr>
<td style="text-align:center">MethodArgumentNotValidException</td>
<td style="text-align:center">400 - Bad Request</td>
</tr>
<tr>
<td style="text-align:center">MissingServletRequestParameterException</td>
<td style="text-align:center">400 - Bad Request</td>
</tr>
<tr>
<td style="text-align:center">MissingServletRequestPartException</td>
<td style="text-align:center">400 - Bad Request</td>
</tr>
<tr>
<td style="text-align:center">NoSuchRequestHandlingMethodException</td>
<td style="text-align:center">404 - Not Found</td>
</tr>
<tr>
<td style="text-align:center">TypeMismatchException</td>
<td style="text-align:center">400 - Bad Request</td>
</tr>
</tbody>
</table>
<h4 id="二异常上可以添加responsestatus注解从而将其映射为某一个http状态码">二、异常上可以添加@ResponseStatus注解，从而将其映射为某一个HTTP状态码；</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="s">&#34;custom exception&#34;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomException</span> <span class="kd">extends</span> <span class="n">RuntimeException</span> <span class="o">{</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="三在方法上可以添加exceptionhandler注解使其用来处理异常">三、在方法上可以添加@ExceptionHandler注解，使其用来处理异常。</h4>
<h5 id="处理同一个controller抛出的异常">处理同一个Controller抛出的异常</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Controller</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestController</span> <span class="o">{</span>
      <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/test&#34;</span><span class="o">)</span>
      <span class="kd">public</span> <span class="n">String</span> <span class="nf">test</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">();</span>
      <span class="o">}</span>
      
      <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
      <span class="kd">public</span> <span class="n">String</span> <span class="nf">handleException</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="s">&#34;404&#34;</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="处理所有controller抛出的异常">处理所有Controller抛出的异常</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@ControllerAdvice</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExceptionHandler</span> <span class="o">{</span>
      <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
      <span class="kd">public</span> <span class="n">String</span> <span class="nf">handleException</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="s">&#34;404&#34;</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="跨重定向请求传递数据">跨重定向请求传递数据</h3>
<h4 id="通过url模板进行重定向">通过URL模板进行重定向</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Controller</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">IndexController</span> <span class="o">{</span>
      <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/test&#34;</span><span class="o">)</span>
      <span class="kd">public</span> <span class="n">String</span> <span class="nf">test</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;userId&#34;</span><span class="o">,</span> <span class="n">123</span><span class="o">);</span>
          <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;userName&#34;</span><span class="o">,</span> <span class="s">&#34;userName&#34;</span><span class="o">);</span>
          <span class="k">return</span> <span class="s">&#34;redirect:/result/{userId}&#34;</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>userId作为占位符填充到了URL模板上，userName虽然没有匹配到占位符，但它会自动以查询参数的形式附加到重定向的URL中，结果得到的URL为：
/result/123?userName=userName</p>
<h4 id="使用flash属性重定向">使用flash属性重定向</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Controller</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">IndexController</span> <span class="o">{</span>
      <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/test&#34;</span><span class="o">)</span>
      <span class="kd">public</span> <span class="n">String</span> <span class="nf">test</span><span class="o">(</span><span class="n">RedirectAttributes</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;userId&#34;</span><span class="o">,</span> <span class="n">123</span><span class="o">);</span>
          <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;userName&#34;</span><span class="o">,</span> <span class="s">&#34;userName&#34;</span><span class="o">);</span>
          <span class="k">return</span> <span class="s">&#34;redirect:/result&#34;</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>在重定向执行之前，所有的flash属性都会复制到会话中。在重定向后，存在会话中的flash属性会被取出，并从会话转移到模型之中。处理重定向的方法就能从模型中访问Spitter对象了，就像获取其他的模型对象一样。</p>
</blockquote>
<p><img src="images/%E3%80%8ASpring%20%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0-3.png" alt="《Spring 实战》笔记-3.puml"></p>
<h2 id="spring与数据库">Spring与数据库</h2>
<h3 id="设计数据访问层的合理方式">设计数据访问层的合理方式</h3>
<p><img src="images/%E3%80%8ASpring%20%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0-4.png" alt="《Spring 实战》笔记-4.puml"></p>
<h3 id="配置datasource">配置DataSource</h3>
<p>首先创建数据库</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="w">  </span><span class="k">CREATE</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">spring_in_action</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="使用jndi-datasource基于tomcat">使用JNDI DataSource（基于Tomcat）</h4>
<h5 id="tomcat配置">Tomcat配置</h5>
<h6 id="编辑tomcat的conf目录下的serverxml文件">编辑Tomcat的conf目录下的server.xml文件</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;GlobalNamingResources&gt;</span>
      <span class="nt">&lt;Resource</span> <span class="na">name=</span><span class="s">&#34;jdbc/spring_in_action&#34;</span>
                <span class="na">type=</span><span class="s">&#34;javax.sql.DataSource&#34;</span>
                <span class="na">username=</span><span class="s">&#34;root&#34;</span>
                <span class="na">password=</span><span class="s">&#34;root&#34;</span>
                <span class="na">url=</span><span class="s">&#34;jdbc:mysql://127.0.0.1:3306/spring_in_action&#34;</span>
                <span class="na">driverClassName=</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span>
                <span class="na">initialSize=</span><span class="s">&#34;20&#34;</span>
                <span class="na">maxTotal=</span><span class="s">&#34;80&#34;</span>
                <span class="na">maxIdle=</span><span class="s">&#34;20&#34;</span>
                <span class="na">maxWaitMillis=</span><span class="s">&#34;10000&#34;</span>
                <span class="nt">/&gt;</span>
  <span class="nt">&lt;/GlobalNamingResources&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="编辑tomcat的conf目录的contextxml文件">编辑Tomcat的conf目录的context.xml文件</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;ResourceLink</span> <span class="na">name=</span><span class="s">&#34;jdbc/spring_in_action&#34;</span> <span class="na">global=</span><span class="s">&#34;jdbc/spring_in_action&#34;</span> <span class="na">type=</span><span class="s">&#34;javax.sql.DataSource&#34;</span><span class="nt">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="向tomcat的lib目录下添加mysql驱动文件mysql-connector-java-5136jar">向Tomcat的lib目录下添加MySQL驱动文件mysql-connector-java-5.1.36.jar</h6>
<h5 id="spring配置">Spring配置</h5>
<h6 id="基于java配置方式-5">基于Java配置方式</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">JndiObjectFactoryBean</span> <span class="nf">dataSource</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">JndiObjectFactoryBean</span> <span class="n">factoryBean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JndiObjectFactoryBean</span><span class="o">();</span>
      <span class="n">factoryBean</span><span class="o">.</span><span class="na">setResourceRef</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
      <span class="n">factoryBean</span><span class="o">.</span><span class="na">setJndiName</span><span class="o">(</span><span class="s">&#34;jdbc/spring_in_action&#34;</span><span class="o">);</span>
      <span class="n">factoryBean</span><span class="o">.</span><span class="na">setProxyInterface</span><span class="o">(</span><span class="n">javax</span><span class="o">.</span><span class="na">sql</span><span class="o">.</span><span class="na">DataSource</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="k">return</span> <span class="n">factoryBean</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="基于xml配置方式-5">基于XML配置方式</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.jndi.JndiObjectFactoryBean&#34;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;resourceRef&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;jndiName&#34;</span> <span class="na">value=</span><span class="s">&#34;jdbc/spring_in_action&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;proxyInterface&#34;</span> <span class="na">value=</span><span class="s">&#34;javax.sql.DataSource&#34;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/bean&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="使用数据库连接池datasource基于c3p0">使用数据库连接池DataSource（基于C3P0）</h4>
<h5 id="基于java配置方式-6">基于Java配置方式</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Bean</span>
  <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">PropertyVetoException</span> <span class="o">{</span>
      <span class="n">ComboPooledDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ComboPooledDataSource</span><span class="o">();</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="o">);</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setJdbcUrl</span><span class="o">(</span><span class="s">&#34;jdbc:mysql://127.0.0.1:3306/spring_in_action&#34;</span><span class="o">);</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="s">&#34;root&#34;</span><span class="o">);</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;root&#34;</span><span class="o">);</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setInitialPoolSize</span><span class="o">(</span><span class="n">20</span><span class="o">);</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setMaxPoolSize</span><span class="o">(</span><span class="n">80</span><span class="o">);</span>
      <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="基于xml配置方式-6">基于XML配置方式</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">class=</span><span class="s">&#34;com.mchange.v2.c3p0.ComboPooledDataSource&#34;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;driverClass&#34;</span> <span class="na">value=</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;jdbcUrl&#34;</span> <span class="na">value=</span><span class="s">&#34;jdbc:mysql://127.0.0.1:3306/spring_in_action&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;user&#34;</span> <span class="na">value=</span><span class="s">&#34;root&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span> <span class="na">value=</span><span class="s">&#34;root&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;initialPoolSize&#34;</span> <span class="na">value=</span><span class="s">&#34;20&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;maxPoolSize&#34;</span> <span class="na">value=</span><span class="s">&#34;80&#34;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/bean&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="声明式事务">声明式事务</h3>
<h4 id="数据库事务">数据库事务</h4>
<h5 id="数据库事务的概念">数据库事务的概念</h5>
<blockquote>
<p>数据库事务(Database Transaction) ，是指作为单个逻辑工作单元执行的一系列操作，要么完全地执行，要么完全地不执行。
数据库事务有严格的定义，它必须同时满足4个特性：原子性（ Atomic )、一致性( Consistency )、隔离性（ Isolation ) 和 持 久 性 （ Durabiliy )，简称为 ACID 。下面是对每个特性的说明。
原子性：表示组成一个事务的多个数据库操作是一个不可分割的原子单元，只有所有的操作执行成功，整个事务才提交。事务中的任何一个数据库操作失败，己经执行的任何操作都必须撤销，让数据库返回到初始状态。
一致性：事务操作成功后，数据库所处的状态和它的业务规则是一致的，即数据不会被破坏。如从 A 账户转账100元到 B 账户，不管操作成功与否， A 账户和 B 账户的存款总额是不变的。
隔离性：在并发数据操作时，不同的事务拥有各自的数据空间，它们的操作不会对对方产生干扰。准确地说，并非要求做到完全无干扰。数据库规定了多种事务隔离级别，不同的隔离级别对应不同的干扰程度，隔离级别越高，数据一致性越好，但并发性越弱。
持久性：一旦事务提交成功后，事务中所有的数据操作都必须被持久化到数据库中。即使在提交事务后，数据库马上崩溃，在数据库重启时，也必须保证能够通过某种机制恢复数据。</p>
</blockquote>
<h5 id="数据并发问题">数据并发问题</h5>
<blockquote>
<p>一个数据库可能拥有多个访问客户端，这些客户端都可用并发的方式访问数据库。数据库中的相同数据可能同时被多个事务访问，如果没有采取必要的隔离措施，就会导致各种并发问题，破坏数据的完整性。这些问题可以归结为5类，包括3类数据读问题(脏读、不可重复读和幻象读）及2类数据更新问题（第一类丢失更新和第二类丢失更新)。</p>
</blockquote>
<h6 id="脏读-dirty-read">脏读 （dirty read)</h6>
<p>A事务读取B事务尚未提交的更改数据，并在这个数据的基础上进行操作。如果恰巧B事务回滚，那么A事务读到的数据根本是不被承认的。来看取款事务和转账事务并发时引发的脏读场景。</p>
<table>
<thead>
<tr>
<th style="text-align:center">时间</th>
<th style="text-align:center">转账事务A</th>
<th style="text-align:center">取款事务B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">T1</td>
<td style="text-align:center"></td>
<td style="text-align:center">开始事务</td>
</tr>
<tr>
<td style="text-align:center">T2</td>
<td style="text-align:center">开始事务</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">T3</td>
<td style="text-align:center"></td>
<td style="text-align:center">査询账户余额为1000元</td>
</tr>
<tr>
<td style="text-align:center">T4</td>
<td style="text-align:center"></td>
<td style="text-align:center">取出500元，把余额改为500元</td>
</tr>
<tr>
<td style="text-align:center">T5</td>
<td style="text-align:center">査询账户余额为500元（脏读）</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">T6</td>
<td style="text-align:center"></td>
<td style="text-align:center">撤销事务，余额恢复为1000元</td>
</tr>
<tr>
<td style="text-align:center">T7</td>
<td style="text-align:center">汇入100元，把余额改为600元</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">T8</td>
<td style="text-align:center">提交事务</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>在这个场景中，B希望取款500元，而后又撤销了动作，而A往相同的账户中转账100元，就因为A事务读取了 B事务尚未提交的数据，因而造成账户白白丢失了 500元。在Oracle数据库中，不会发生脏读的情况。</p>
<h6 id="不可重复读-unrepeatable-read">不可重复读 （unrepeatable read)</h6>
<p>不可重复读是指A事务读取了 B事务己经提交的更改数据。假设A在取款事务的过程中，B往该账户转账100元，A两次读取账户的余额发生不一致。</p>
<table>
<thead>
<tr>
<th style="text-align:center">时间</th>
<th style="text-align:center">取款事务A</th>
<th style="text-align:center">转账事务B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">T1</td>
<td style="text-align:center"></td>
<td style="text-align:center">开始事务</td>
</tr>
<tr>
<td style="text-align:center">T2幵始事务</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">T3</td>
<td style="text-align:center"></td>
<td style="text-align:center">査询账户余额为1000元</td>
</tr>
<tr>
<td style="text-align:center">T4</td>
<td style="text-align:center">查询账户余额为1000元</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">T5</td>
<td style="text-align:center"></td>
<td style="text-align:center">取出100元，把余额改为900元</td>
</tr>
<tr>
<td style="text-align:center">T6</td>
<td style="text-align:center"></td>
<td style="text-align:center">提交事务</td>
</tr>
<tr>
<td style="text-align:center">T7</td>
<td style="text-align:center">査询账户余额为900元（和T4读取的不一致）</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>在同一事务中，T4时间点和T7时间点读取的账户存款余额不一致</p>
<h6 id="幻象读-phantom-read">幻象读 （phantom read)</h6>
<p>A事务读取B事务提交的新增数据，这时A事务将出现幻象读的问题。幻象读一般发生在计算统计数据的事务中。举个例子，假设银行系统在同一个事务中两次统计存款账户的总金额，在两次统计过程中，刚好新增了一个存款账户，并存入100元，这时,两次统计的总金额将不一致。</p>
<table>
<thead>
<tr>
<th style="text-align:center">时间</th>
<th style="text-align:center">统计金额事务A</th>
<th style="text-align:center">转账事务B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">T1</td>
<td style="text-align:center"></td>
<td style="text-align:center">开始事务</td>
</tr>
<tr>
<td style="text-align:center">T2</td>
<td style="text-align:center">开始事务</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">T3</td>
<td style="text-align:center">统计总存款数为10000元</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">T4</td>
<td style="text-align:center"></td>
<td style="text-align:center">新增一个存款账户，存款为100元</td>
</tr>
<tr>
<td style="text-align:center">T5</td>
<td style="text-align:center"></td>
<td style="text-align:center">提交事务</td>
</tr>
<tr>
<td style="text-align:center">T6</td>
<td style="text-align:center">再次统计总存款数为10100元（幻象读）</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>如果新增数据刚好满足事务的查询条件，那么这个新数据就进入了事务的视野，因而产生了两次统计结果不一致的情况。幻象读和木可重复读是两个容易混淆的概念，前者是指读到了其他己经提交事务的新增数据，而后者是指读到了己经提交事务的更改数据（更改或删除）。为了避免这两种情况，采取的对策是不同的：防止读到更改数据，只需对操作的数据添加行级锁，阻止操作中的数据发生变化；而防止读到新增数据，则往往需要添加表级锁——将整张表锁定，防止新增数据（ Oracle 使用多版本数据的方式实现）。</p>
<h6 id="第一类丢失更新">第一类丢失更新</h6>
<p>A事务撤销时，把己经提交的B事务的更新数据覆盖了。这种错误可能造成很严重的问题，通过下面的账户取款转账就可以看出来。</p>
<table>
<thead>
<tr>
<th style="text-align:center">时间</th>
<th style="text-align:center">取款事务A</th>
<th style="text-align:center">转账事务B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">T1</td>
<td style="text-align:center">开始事务</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">T2</td>
<td style="text-align:center"></td>
<td style="text-align:center">开始事务</td>
</tr>
<tr>
<td style="text-align:center">T3</td>
<td style="text-align:center">查询账户余额为1000元</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">T4</td>
<td style="text-align:center"></td>
<td style="text-align:center">查询账户余额为1000元</td>
</tr>
<tr>
<td style="text-align:center">T5</td>
<td style="text-align:center"></td>
<td style="text-align:center">汇入100元，把余额改为1100元</td>
</tr>
<tr>
<td style="text-align:center">T6</td>
<td style="text-align:center"></td>
<td style="text-align:center">提交事务</td>
</tr>
<tr>
<td style="text-align:center">T7</td>
<td style="text-align:center">取出100元，把余额改为900元</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">T8</td>
<td style="text-align:center">撤销事务</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">T9</td>
<td style="text-align:center">余额恢复为1000元（丢失更新）</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>A事务在撤销时，“不小心”将B事务己经转入账户的金额给抹去了。</p>
<h6 id="第二类丟失更新">第二类丟失更新</h6>
<p>A事务覆盖B事务己经提交的数据，造成B事务所做操作丢失。</p>
<table>
<thead>
<tr>
<th style="text-align:center">时间</th>
<th style="text-align:center">转账事务A</th>
<th style="text-align:center">取款事务B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">T1</td>
<td style="text-align:center"></td>
<td style="text-align:center">开始事务</td>
</tr>
<tr>
<td style="text-align:center">T2</td>
<td style="text-align:center">开始事务</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">T3</td>
<td style="text-align:center"></td>
<td style="text-align:center">查询账户余额为1000元</td>
</tr>
<tr>
<td style="text-align:center">T4</td>
<td style="text-align:center">查询账户余额为1000元</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">T5</td>
<td style="text-align:center"></td>
<td style="text-align:center">取出100元，把余额改为900元</td>
</tr>
<tr>
<td style="text-align:center">T6</td>
<td style="text-align:center"></td>
<td style="text-align:center">提交事务</td>
</tr>
<tr>
<td style="text-align:center">T7</td>
<td style="text-align:center">汇入100元</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">T8</td>
<td style="text-align:center">提交事务</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">T9</td>
<td style="text-align:center">把余额改为1100元（丢失更新）</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>在上面的例子中，由于支票转账事务覆盖了取款事务对存款余额所做的更新，导致银行最后损失了 100元。相反，如果转账事务先提交，那么用户账户将损失100元。</p>
<h5 id="事务隔离级别">事务隔离级别</h5>
<p>尽管数据库为用户提供了锁的 DML 操作方式，但直接使用锁管理是非常麻烦的，因此数据库为用户提供了自动锁机制。只要用户指定会话的事务隔离级别，数据库就会分析事务中的 SQL 语句，然后自动为事务操作的数据资源添加适合的锁。此外，数据库还会维护这些锁，当一个资源上的锁数目太多时，自动进行锁升级以提高系统的运行性能，而这一过程对用户来说完全是透明的。ANSI/ISO SQL 92标准定义了 4个等级的事务隔离级别，在相同的数据环境下，使用相同的输入，执行相同的工作，根据不同的隔离级别，可能导致不同的结果。不同的事务隔离级别能够解决的数据并发问题的能力是不同的。</p>
<table>
<thead>
<tr>
<th style="text-align:center">隔离级别</th>
<th style="text-align:center">脏读</th>
<th style="text-align:center">不可重复读</th>
<th style="text-align:center">幻象读</th>
<th style="text-align:center">第一类丟失更新</th>
<th style="text-align:center">第二类丢失更新</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">READ UNCOMMITED</td>
<td style="text-align:center">允许</td>
<td style="text-align:center">允许</td>
<td style="text-align:center">允许</td>
<td style="text-align:center">不允许</td>
<td style="text-align:center">允 许</td>
</tr>
<tr>
<td style="text-align:center">READ COMMITTED</td>
<td style="text-align:center">不允许</td>
<td style="text-align:center">允许</td>
<td style="text-align:center">允许</td>
<td style="text-align:center">不允许</td>
<td style="text-align:center">允 许</td>
</tr>
<tr>
<td style="text-align:center">REPEATABLE READ</td>
<td style="text-align:center">不允许</td>
<td style="text-align:center">不允许</td>
<td style="text-align:center">允许</td>
<td style="text-align:center">不允许</td>
<td style="text-align:center">不允许</td>
</tr>
<tr>
<td style="text-align:center">SERIALIZABLE</td>
<td style="text-align:center">不允许</td>
<td style="text-align:center">不允许</td>
<td style="text-align:center">不允许</td>
<td style="text-align:center">不允许</td>
<td style="text-align:center">不允许</td>
</tr>
</tbody>
</table>
<p>事务的隔离级别和数据库并发性是对立的 。一 般来说，使用 READUNCOMMITED隔离级别的数据库拥有最高的并发性和吞吐量，而使用 SERIALIZABLE 隔离级别的数据库并发性最低。
SQL 92定义 READ UNCOMMITED 主要是为了提供非阻塞读的能力。 Oracle 虽然也支持 READ UNC 0 MM 1 TED ,但它不支持脏读；因为 Oracle 使用多版本机制彻底解决了 在 非 阻 塞 读 时 读 到 脏 数 据 的 问 题 并 保 证 读 的 一 致 性 ， 所 以 ， Oracle 的 READCOMMITTED 隔离级别就己经满足了 SQL 92标准的 REPEATABLE READ 隔离级别。SQL 92推荐使用 REPEATABLE READ 以保证数据的读一致性，不过用户可以根据应用的需要选择适合的隔离等级。</p>
<h5 id="事务传播行为">事务传播行为</h5>
<p>Spring规定了7种类型的事务传播行为，它们规定了事务方法和事务方法发生嵌套调用时事务如何进行传播。</p>
<table>
<thead>
<tr>
<th style="text-align:center">事务传播行为类型</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">PROPAGATION_REQUIRED</td>
<td style="text-align:center">如果当前没有事务，则新建一个事务；如果己经存在一个事务，则加入到这个事务中。这是最常见的选择</td>
</tr>
<tr>
<td style="text-align:center">PROPAGATION_SUPPORTS</td>
<td style="text-align:center">支持当前事务。如果当前没有事务，则以非事务方式执行</td>
</tr>
<tr>
<td style="text-align:center">PROPAGATION_MANDATORY</td>
<td style="text-align:center">使用当前的事务。如果当前没有事务，则抛出异常</td>
</tr>
<tr>
<td style="text-align:center">PROPAGATION_JIEQUHIES_NEW</td>
<td style="text-align:center">新建事务。如果当前存在事务，则把当前事务挂起</td>
</tr>
<tr>
<td style="text-align:center">PROPAGATION_NOT_SUPPORTED</td>
<td style="text-align:center">以非事务方式执行操作。如果当前存在事务，则把当前事务挂起</td>
</tr>
<tr>
<td style="text-align:center">PROPAGATION_NEVER</td>
<td style="text-align:center">以非事务方式执行。如果当前存在事务，则抛出异常</td>
</tr>
<tr>
<td style="text-align:center">PROPAGATION_NESTED</td>
<td style="text-align:center">如果当前存在事务，则在嵌套事务内执行；如果当前没有事务，则执行与PROPAGATION_REQUIRED类似的操作</td>
</tr>
</tbody>
</table>
<p>在使用 PROPAGATION_NESTED时，底层的数据源必须基于 JDBC3.0 , 并且实现者需要支持保存点事务机制。</p>
<h4 id="java方式配置">Java方式配置</h4>
<h5 id="spring配置-1">Spring配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@ComponentScan</span>
  <span class="nd">@EnableTransactionManagement</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>
      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">PropertyVetoException</span> <span class="o">{</span>
          <span class="n">ComboPooledDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ComboPooledDataSource</span><span class="o">();</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setJdbcUrl</span><span class="o">(</span><span class="s">&#34;jdbc:mysql://127.0.0.1:3306/spring_in_action&#34;</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="s">&#34;root&#34;</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;root&#34;</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setInitialPoolSize</span><span class="o">(</span><span class="n">20</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setMaxPoolSize</span><span class="o">(</span><span class="n">80</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">LocalSessionFactoryBean</span> <span class="nf">sessionFactory</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">LocalSessionFactoryBean</span> <span class="n">localSessionFactoryBean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalSessionFactoryBean</span><span class="o">();</span>
          <span class="n">localSessionFactoryBean</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
          <span class="n">localSessionFactoryBean</span><span class="o">.</span><span class="na">setPackagesToScan</span><span class="o">(</span><span class="s">&#34;com.demo&#34;</span><span class="o">);</span>
          <span class="n">Properties</span> <span class="n">properties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
          <span class="n">properties</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">AUTOCOMMIT</span><span class="o">,</span> <span class="s">&#34;false&#34;</span><span class="o">);</span>
          <span class="n">properties</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">DIALECT</span><span class="o">,</span> <span class="s">&#34;org.hibernate.dialect.MySQLDialect&#34;</span><span class="o">);</span>
          <span class="n">localSessionFactoryBean</span><span class="o">.</span><span class="na">setHibernateProperties</span><span class="o">(</span><span class="n">properties</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">localSessionFactoryBean</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">PlatformTransactionManager</span> <span class="nf">transactionManager</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">,</span> <span class="n">SessionFactory</span> <span class="n">sessionFactory</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">HibernateTransactionManager</span> <span class="n">transactionManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HibernateTransactionManager</span><span class="o">();</span>
          <span class="n">transactionManager</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
          <span class="n">transactionManager</span><span class="o">.</span><span class="na">setSessionFactory</span><span class="o">(</span><span class="n">sessionFactory</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">transactionManager</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="service层">Service层</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Service</span>
  <span class="nd">@Transactional</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestServiceImpl</span> <span class="kd">implements</span> <span class="n">TestService</span> <span class="o">{</span>

      <span class="nd">@Autowired</span>
      <span class="kd">private</span> <span class="n">TestDao</span> <span class="n">testDao</span><span class="o">;</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">testDao</span><span class="o">.</span><span class="na">getUser</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">testDao</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">testDao</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="dao层">DAO层</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Repository</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestDaoImpl</span> <span class="kd">implements</span> <span class="n">TestDao</span> <span class="o">{</span>

      <span class="nd">@Autowired</span>
      <span class="kd">private</span> <span class="n">SessionFactory</span> <span class="n">sessionFactory</span><span class="o">;</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">();</span>
          <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">();</span>
          <span class="n">session</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">().</span><span class="na">update</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="xml方式配置">XML方式配置</h4>
<h5 id="spring配置-2">Spring配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
  <span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
         <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
         <span class="na">xmlns:tx=</span><span class="s">&#34;http://www.springframework.org/schema/tx&#34;</span>
         <span class="na">xmlns:aop=</span><span class="s">&#34;http://www.springframework.org/schema/aop&#34;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans
</span><span class="s">         http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">         http://www.springframework.org/schema/context
</span><span class="s">         http://www.springframework.org/schema/context/spring-context.xsd
</span><span class="s">         http://www.springframework.org/schema/tx
</span><span class="s">         http://www.springframework.org/schema/tx/spring-tx.xsd
</span><span class="s">         http://www.springframework.org/schema/aop
</span><span class="s">         http://www.springframework.org/schema/aop/spring-aop.xsd
</span><span class="s">         &#34;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.demo&#34;</span><span class="nt">/&gt;</span>

         <span class="nt">&lt;tx:annotation-driven</span> <span class="na">transaction-manager=</span><span class="s">&#34;transactionManager&#34;</span><span class="nt">/&gt;</span>

         <span class="nt">&lt;aop:config&gt;</span>
                <span class="nt">&lt;aop:advisor</span> <span class="na">advice-ref=</span><span class="s">&#34;txAdvice&#34;</span> <span class="na">pointcut=</span><span class="s">&#34;execution(* com..*Service*.*(..))&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/aop:config&gt;</span>

         <span class="nt">&lt;tx:advice</span> <span class="na">id=</span><span class="s">&#34;txAdvice&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;tx:attributes&gt;</span>
                       <span class="nt">&lt;tx:method</span> <span class="na">name=</span><span class="s">&#34;*&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/tx:attributes&gt;</span>
         <span class="nt">&lt;/tx:advice&gt;</span>

         <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">class=</span><span class="s">&#34;com.mchange.v2.c3p0.ComboPooledDataSource&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;driverClass&#34;</span> <span class="na">value=</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;jdbcUrl&#34;</span> <span class="na">value=</span><span class="s">&#34;jdbc:mysql://127.0.0.1:3306/spring_in_action&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;user&#34;</span> <span class="na">value=</span><span class="s">&#34;root&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span> <span class="na">value=</span><span class="s">&#34;root&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;initialPoolSize&#34;</span> <span class="na">value=</span><span class="s">&#34;20&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;maxPoolSize&#34;</span> <span class="na">value=</span><span class="s">&#34;80&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/bean&gt;</span>

         <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;sessionFactory&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.orm.hibernate5.LocalSessionFactoryBean&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">ref=</span><span class="s">&#34;dataSource&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;packagesToScan&#34;</span> <span class="na">value=</span><span class="s">&#34;com.demo&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;hibernateProperties&#34;</span><span class="nt">&gt;</span>
                       <span class="nt">&lt;props&gt;</span>
                              <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">&#34;hibernate.connection.autocommit&#34;</span><span class="nt">&gt;</span>false<span class="nt">&lt;/prop&gt;</span>
                              <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">&#34;hibernate.dialect&#34;</span><span class="nt">&gt;</span>org.hibernate.dialect.MySQLDialect<span class="nt">&lt;/prop&gt;</span>
                       <span class="nt">&lt;/props&gt;</span>
                <span class="nt">&lt;/property&gt;</span>
         <span class="nt">&lt;/bean&gt;</span>

         <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;transactionManager&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.orm.hibernate5.HibernateTransactionManager&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">ref=</span><span class="s">&#34;dataSource&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;sessionFactory&#34;</span> <span class="na">ref=</span><span class="s">&#34;sessionFactory&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/bean&gt;</span>

         <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;testDao&#34;</span> <span class="na">class=</span><span class="s">&#34;com.demo.TestDaoImpl&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;sessionFactory&#34;</span> <span class="na">ref=</span><span class="s">&#34;sessionFactory&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/bean&gt;</span>

         <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;testService&#34;</span> <span class="na">class=</span><span class="s">&#34;com.demo.TestServiceImpl&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;testDao&#34;</span> <span class="na">ref=</span><span class="s">&#34;testDao&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/bean&gt;</span>
  <span class="nt">&lt;/beans&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="service层-1">Service层</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestServiceImpl</span> <span class="kd">implements</span> <span class="n">TestService</span> <span class="o">{</span>

      <span class="kd">private</span> <span class="n">TestDao</span> <span class="n">testDao</span><span class="o">;</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">testDao</span><span class="o">.</span><span class="na">getUser</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">testDao</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">testDao</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>
      
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTestDao</span><span class="o">(</span><span class="n">TestDao</span> <span class="n">testDao</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">testDao</span> <span class="o">=</span> <span class="n">testDao</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h5 id="dao层-1">DAO层</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestDaoImpl</span> <span class="kd">implements</span> <span class="n">TestDao</span> <span class="o">{</span>

      <span class="kd">private</span> <span class="n">SessionFactory</span> <span class="n">sessionFactory</span><span class="o">;</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">();</span>
          <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">();</span>
          <span class="n">session</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">().</span><span class="na">update</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSessionFactory</span><span class="o">(</span><span class="n">SessionFactory</span> <span class="n">sessionFactory</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">sessionFactory</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="spring集成hibernate">Spring集成Hibernate</h3>
<h4 id="基于java配置方式-7">基于Java配置方式</h4>
<h5 id="spring配置-3">Spring配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@ComponentScan</span>
  <span class="nd">@EnableTransactionManagement</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>
      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">PropertyVetoException</span> <span class="o">{</span>
          <span class="n">ComboPooledDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ComboPooledDataSource</span><span class="o">();</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setJdbcUrl</span><span class="o">(</span><span class="s">&#34;jdbc:mysql://127.0.0.1:3306/spring_in_action&#34;</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="s">&#34;root&#34;</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;root&#34;</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setInitialPoolSize</span><span class="o">(</span><span class="n">20</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setMaxPoolSize</span><span class="o">(</span><span class="n">80</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">LocalSessionFactoryBean</span> <span class="nf">sessionFactory</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">LocalSessionFactoryBean</span> <span class="n">localSessionFactoryBean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalSessionFactoryBean</span><span class="o">();</span>
          <span class="n">localSessionFactoryBean</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
          <span class="n">localSessionFactoryBean</span><span class="o">.</span><span class="na">setPackagesToScan</span><span class="o">(</span><span class="s">&#34;com.demo&#34;</span><span class="o">);</span>
          <span class="n">Properties</span> <span class="n">properties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
          <span class="n">properties</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">AUTOCOMMIT</span><span class="o">,</span> <span class="s">&#34;false&#34;</span><span class="o">);</span>
          <span class="n">properties</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="n">Environment</span><span class="o">.</span><span class="na">DIALECT</span><span class="o">,</span> <span class="s">&#34;org.hibernate.dialect.MySQLDialect&#34;</span><span class="o">);</span>
          <span class="n">localSessionFactoryBean</span><span class="o">.</span><span class="na">setHibernateProperties</span><span class="o">(</span><span class="n">properties</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">localSessionFactoryBean</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">PlatformTransactionManager</span> <span class="nf">transactionManager</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">,</span> <span class="n">SessionFactory</span> <span class="n">sessionFactory</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">HibernateTransactionManager</span> <span class="n">transactionManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HibernateTransactionManager</span><span class="o">();</span>
          <span class="n">transactionManager</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
          <span class="n">transactionManager</span><span class="o">.</span><span class="na">setSessionFactory</span><span class="o">(</span><span class="n">sessionFactory</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">transactionManager</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="编辑service">编辑Service</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Service</span>
  <span class="nd">@Transactional</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestServiceImpl</span> <span class="kd">implements</span> <span class="n">TestService</span> <span class="o">{</span>

      <span class="nd">@Autowired</span>
      <span class="kd">private</span> <span class="n">TestDao</span> <span class="n">testDao</span><span class="o">;</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">testDao</span><span class="o">.</span><span class="na">getUser</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">testDao</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">testDao</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h5 id="编辑dao">编辑DAO</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Repository</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestDaoImpl</span> <span class="kd">implements</span> <span class="n">TestDao</span> <span class="o">{</span>

      <span class="nd">@Autowired</span>
      <span class="kd">private</span> <span class="n">SessionFactory</span> <span class="n">sessionFactory</span><span class="o">;</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">();</span>
          <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">();</span>
          <span class="n">session</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">().</span><span class="na">update</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h4 id="基于xml配置方式-7">基于XML配置方式</h4>
<h5 id="spring配置-4">Spring配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
  <span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
         <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
         <span class="na">xmlns:tx=</span><span class="s">&#34;http://www.springframework.org/schema/tx&#34;</span>
         <span class="na">xmlns:aop=</span><span class="s">&#34;http://www.springframework.org/schema/aop&#34;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans
</span><span class="s">         http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">         http://www.springframework.org/schema/context
</span><span class="s">         http://www.springframework.org/schema/context/spring-context.xsd
</span><span class="s">         http://www.springframework.org/schema/tx
</span><span class="s">         http://www.springframework.org/schema/tx/spring-tx.xsd
</span><span class="s">         http://www.springframework.org/schema/aop
</span><span class="s">         http://www.springframework.org/schema/aop/spring-aop.xsd
</span><span class="s">         &#34;</span><span class="nt">&gt;</span>
         <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.demo&#34;</span><span class="nt">/&gt;</span>

         <span class="nt">&lt;tx:annotation-driven</span> <span class="na">transaction-manager=</span><span class="s">&#34;transactionManager&#34;</span><span class="nt">/&gt;</span>

         <span class="nt">&lt;aop:config&gt;</span>
                <span class="nt">&lt;aop:advisor</span> <span class="na">advice-ref=</span><span class="s">&#34;txAdvice&#34;</span> <span class="na">pointcut=</span><span class="s">&#34;execution(* com..*Service*.*(..))&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/aop:config&gt;</span>

         <span class="nt">&lt;tx:advice</span> <span class="na">id=</span><span class="s">&#34;txAdvice&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;tx:attributes&gt;</span>
                       <span class="nt">&lt;tx:method</span> <span class="na">name=</span><span class="s">&#34;*&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/tx:attributes&gt;</span>
         <span class="nt">&lt;/tx:advice&gt;</span>

         <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">class=</span><span class="s">&#34;com.mchange.v2.c3p0.ComboPooledDataSource&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;driverClass&#34;</span> <span class="na">value=</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;jdbcUrl&#34;</span> <span class="na">value=</span><span class="s">&#34;jdbc:mysql://127.0.0.1:3306/spring_in_action&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;user&#34;</span> <span class="na">value=</span><span class="s">&#34;root&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span> <span class="na">value=</span><span class="s">&#34;root&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;initialPoolSize&#34;</span> <span class="na">value=</span><span class="s">&#34;20&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;maxPoolSize&#34;</span> <span class="na">value=</span><span class="s">&#34;80&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/bean&gt;</span>

         <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;sessionFactory&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.orm.hibernate5.LocalSessionFactoryBean&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">ref=</span><span class="s">&#34;dataSource&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;packagesToScan&#34;</span> <span class="na">value=</span><span class="s">&#34;com.demo&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;hibernateProperties&#34;</span><span class="nt">&gt;</span>
                       <span class="nt">&lt;props&gt;</span>
                              <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">&#34;hibernate.connection.autocommit&#34;</span><span class="nt">&gt;</span>false<span class="nt">&lt;/prop&gt;</span>
                              <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">&#34;hibernate.dialect&#34;</span><span class="nt">&gt;</span>org.hibernate.dialect.MySQLDialect<span class="nt">&lt;/prop&gt;</span>
                       <span class="nt">&lt;/props&gt;</span>
                <span class="nt">&lt;/property&gt;</span>
         <span class="nt">&lt;/bean&gt;</span>

         <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;transactionManager&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.orm.hibernate5.HibernateTransactionManager&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">ref=</span><span class="s">&#34;dataSource&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;sessionFactory&#34;</span> <span class="na">ref=</span><span class="s">&#34;sessionFactory&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/bean&gt;</span>

         <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;testDao&#34;</span> <span class="na">class=</span><span class="s">&#34;com.demo.TestDaoImpl&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;sessionFactory&#34;</span> <span class="na">ref=</span><span class="s">&#34;sessionFactory&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/bean&gt;</span>

         <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;testService&#34;</span> <span class="na">class=</span><span class="s">&#34;com.demo.TestServiceImpl&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;testDao&#34;</span> <span class="na">ref=</span><span class="s">&#34;testDao&#34;</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/bean&gt;</span>
  <span class="nt">&lt;/beans&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="编写service">编写Service</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestServiceImpl</span> <span class="kd">implements</span> <span class="n">TestService</span> <span class="o">{</span>

      <span class="kd">private</span> <span class="n">TestDao</span> <span class="n">testDao</span><span class="o">;</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">testDao</span><span class="o">.</span><span class="na">getUser</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">testDao</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">testDao</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTestDao</span><span class="o">(</span><span class="n">TestDao</span> <span class="n">testDao</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">testDao</span> <span class="o">=</span> <span class="n">testDao</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="编写dao">编写DAO</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestDaoImpl</span> <span class="kd">implements</span> <span class="n">TestDao</span> <span class="o">{</span>

      <span class="kd">private</span> <span class="n">SessionFactory</span> <span class="n">sessionFactory</span><span class="o">;</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">();</span>
          <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">();</span>
          <span class="n">session</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">().</span><span class="na">update</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSessionFactory</span><span class="o">(</span><span class="n">SessionFactory</span> <span class="n">sessionFactory</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">this</span><span class="o">.</span><span class="na">sessionFactory</span> <span class="o">=</span> <span class="n">sessionFactory</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="spring集成原生jpa">Spring集成原生JPA</h3>
<h4 id="配置实体管理器工厂">配置实体管理器工厂</h4>
<blockquote>
<p>JPA定义了两种类型的实体管理器：
应用程序管理类型（Application-managed）：当应用程序向实体管理器工厂直接请求实体管理器时，工厂会创建一个实体管理器。在这种模式下，程序要负责打开或关闭实体管理器并在事务中对其进行控制。这种方式的实体管理器适合于不运行在JavaEE容器中的独立应用程序。
容器管理类型（Container-managed）：实体管理器由Java EE创建和管理。应用程序根本不与实体管理器工厂打交道。相反，实体管理器直接通过注入或JNDI来获取。容器负责配置实体管理器工厂。这种类型的实体管理器最适用于Java EE容器，在这种情况下会希望在persistence.xml指定的JPA配置之外保持一些自己对JPA的控制。以上的两种实体管理器
这两种实体管理器工厂分别由对应的Spring工厂Bean创建：
LocalEntityManagerFactoryBean生成应用程序管理类型的EntityManager-Factory；
LocalContainerEntityManagerFactoryBean生成容器管理类型的Entity-ManagerFactory。
推荐使用LocalContainerEntityManagerFactoryBean，因为LocalEntityManagerFactoryBean需要把配置信息填写在META-INF目录下的persistence.xml文件中，而LocalContainerEntityManagerFactoryBean可以不需要persistence.xml文件</p>
</blockquote>
<h5 id="spring配置-5">Spring配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@ComponentScan</span>
  <span class="nd">@EnableTransactionManagement</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">PropertyVetoException</span> <span class="o">{</span>
          <span class="n">ComboPooledDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ComboPooledDataSource</span><span class="o">();</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setJdbcUrl</span><span class="o">(</span><span class="s">&#34;jdbc:mysql://127.0.0.1:3306/spring_in_action&#34;</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="s">&#34;root&#34;</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;root&#34;</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setInitialPoolSize</span><span class="o">(</span><span class="n">20</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setMaxPoolSize</span><span class="o">(</span><span class="n">80</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">JpaVendorAdapter</span> <span class="nf">jpaVendorAdapter</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">HibernateJpaVendorAdapter</span> <span class="n">jpaVendorAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HibernateJpaVendorAdapter</span><span class="o">();</span>
          <span class="n">jpaVendorAdapter</span><span class="o">.</span><span class="na">setDatabase</span><span class="o">(</span><span class="n">Database</span><span class="o">.</span><span class="na">MYSQL</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">jpaVendorAdapter</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="nf">entityManagerFactory</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">,</span> <span class="n">JpaVendorAdapter</span> <span class="n">jpaVendorAdapter</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="n">factoryBean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalContainerEntityManagerFactoryBean</span><span class="o">();</span>
          <span class="n">factoryBean</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
          <span class="n">factoryBean</span><span class="o">.</span><span class="na">setPackagesToScan</span><span class="o">(</span><span class="s">&#34;com.demo&#34;</span><span class="o">);</span>
          <span class="n">factoryBean</span><span class="o">.</span><span class="na">setJpaVendorAdapter</span><span class="o">(</span><span class="n">jpaVendorAdapter</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">factoryBean</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">PlatformTransactionManager</span> <span class="nf">transactionManager</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">,</span> <span class="n">EntityManagerFactory</span> <span class="n">emf</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">JpaTransactionManager</span> <span class="n">transactionManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JpaTransactionManager</span><span class="o">();</span>
          <span class="n">transactionManager</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
          <span class="n">transactionManager</span><span class="o">.</span><span class="na">setEntityManagerFactory</span><span class="o">(</span><span class="n">emf</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">transactionManager</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="编写service-1">编写Service</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Service</span>
  <span class="nd">@Transactional</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestServiceImpl</span> <span class="kd">implements</span> <span class="n">TestService</span> <span class="o">{</span>

      <span class="nd">@Autowired</span>
      <span class="kd">private</span> <span class="n">TestDao</span> <span class="n">testDao</span><span class="o">;</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">testDao</span><span class="o">.</span><span class="na">getUser</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">testDao</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">testDao</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h5 id="编写dao-1">编写DAO</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Repository</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestDaoImpl</span> <span class="kd">implements</span> <span class="n">TestDao</span> <span class="o">{</span>

      <span class="nd">@PersistenceContext</span>
      <span class="kd">private</span> <span class="n">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">User</span> <span class="nf">getUser</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">entityManager</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">entityManager</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">entityManager</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="spring-data-jpa">Spring Data JPA</h3>
<h4 id="spring配置-6">Spring配置</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@ComponentScan</span>
  <span class="nd">@EnableTransactionManagement</span>
  <span class="nd">@EnableJpaRepositories</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">&#34;com.demo&#34;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">PropertyVetoException</span> <span class="o">{</span>
          <span class="n">ComboPooledDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ComboPooledDataSource</span><span class="o">();</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="s">&#34;com.mysql.jdbc.Driver&#34;</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setJdbcUrl</span><span class="o">(</span><span class="s">&#34;jdbc:mysql://127.0.0.1:3306/spring_in_action&#34;</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="s">&#34;root&#34;</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;root&#34;</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setInitialPoolSize</span><span class="o">(</span><span class="n">20</span><span class="o">);</span>
          <span class="n">dataSource</span><span class="o">.</span><span class="na">setMaxPoolSize</span><span class="o">(</span><span class="n">80</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">JpaVendorAdapter</span> <span class="nf">jpaVendorAdapter</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">HibernateJpaVendorAdapter</span> <span class="n">jpaVendorAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HibernateJpaVendorAdapter</span><span class="o">();</span>
          <span class="n">jpaVendorAdapter</span><span class="o">.</span><span class="na">setDatabase</span><span class="o">(</span><span class="n">Database</span><span class="o">.</span><span class="na">MYSQL</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">jpaVendorAdapter</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="nf">entityManagerFactory</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">,</span> <span class="n">JpaVendorAdapter</span> <span class="n">jpaVendorAdapter</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="n">factoryBean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LocalContainerEntityManagerFactoryBean</span><span class="o">();</span>
          <span class="n">factoryBean</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
          <span class="n">factoryBean</span><span class="o">.</span><span class="na">setPackagesToScan</span><span class="o">(</span><span class="s">&#34;com.demo&#34;</span><span class="o">);</span>
          <span class="n">factoryBean</span><span class="o">.</span><span class="na">setJpaVendorAdapter</span><span class="o">(</span><span class="n">jpaVendorAdapter</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">factoryBean</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">PlatformTransactionManager</span> <span class="nf">transactionManager</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">,</span> <span class="n">EntityManagerFactory</span> <span class="n">emf</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">JpaTransactionManager</span> <span class="n">transactionManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JpaTransactionManager</span><span class="o">();</span>
          <span class="n">transactionManager</span><span class="o">.</span><span class="na">setDataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
          <span class="n">transactionManager</span><span class="o">.</span><span class="na">setEntityManagerFactory</span><span class="o">(</span><span class="n">emf</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">transactionManager</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="根据方法名查询">根据方法名查询</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TestDao</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
      <span class="n">User</span> <span class="nf">getUserById</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="自定义查询">自定义查询</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TestDao</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
      <span class="nd">@Query</span><span class="o">(</span><span class="s">&#34;select u from User u where u.id=?1&#34;</span><span class="o">)</span>
      <span class="n">User</span> <span class="nf">getUserById</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="spring-data-mongodb">Spring Data MongoDB</h3>
<h4 id="mongodb-repository">MongoDB Repository</h4>
<h5 id="spring配置-7">Spring配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@EnableMongoRepositories</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">&#34;com.demo&#34;</span><span class="o">)</span>
  <span class="nd">@ComponentScan</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">MongoClientFactoryBean</span> <span class="nf">mongo</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">MongoClientFactoryBean</span> <span class="n">mongo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongoClientFactoryBean</span><span class="o">();</span>
          <span class="n">mongo</span><span class="o">.</span><span class="na">setHost</span><span class="o">(</span><span class="s">&#34;127.0.0.1&#34;</span><span class="o">);</span>
          <span class="n">mongo</span><span class="o">.</span><span class="na">setPort</span><span class="o">(</span><span class="n">27017</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">mongo</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">MongoTemplate</span> <span class="nf">mongoTemplate</span><span class="o">(</span><span class="n">Mongo</span> <span class="n">mongo</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">MongoTemplate</span> <span class="n">mongoTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongoTemplate</span><span class="o">(</span><span class="n">mongo</span><span class="o">,</span> <span class="s">&#34;test&#34;</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">mongoTemplate</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="编写dao-2">编写DAO</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TestDao</span> <span class="kd">extends</span> <span class="n">MongoRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
      <span class="n">User</span> <span class="nf">findByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>

      <span class="nd">@Query</span><span class="o">(</span><span class="s">&#34;{&#39;name&#39;:&#39;?0&#39;}&#34;</span><span class="o">)</span>
      <span class="n">User</span> <span class="nf">find</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="使用mongotemplate">使用MongoTemplate</h4>
<h5 id="spring配置-8">Spring配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@EnableMongoRepositories</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">&#34;com.demo&#34;</span><span class="o">)</span>
  <span class="nd">@ComponentScan</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>
      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">MongoClientFactoryBean</span> <span class="nf">mongo</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">MongoClientFactoryBean</span> <span class="n">mongo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongoClientFactoryBean</span><span class="o">();</span>
          <span class="n">mongo</span><span class="o">.</span><span class="na">setHost</span><span class="o">(</span><span class="s">&#34;127.0.0.1&#34;</span><span class="o">);</span>
          <span class="n">mongo</span><span class="o">.</span><span class="na">setPort</span><span class="o">(</span><span class="n">27017</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">mongo</span><span class="o">;</span>
      <span class="o">}</span>
      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">MongoTemplate</span> <span class="nf">mongoTemplate</span><span class="o">(</span><span class="n">Mongo</span> <span class="n">mongo</span><span class="o">)</span> <span class="o">{</span>
          <span class="n">MongoTemplate</span> <span class="n">mongoTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MongoTemplate</span><span class="o">(</span><span class="n">mongo</span><span class="o">,</span> <span class="s">&#34;test&#34;</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">mongoTemplate</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="编写dao-3">编写DAO</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Repository</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestDaoImpl</span> <span class="kd">implements</span> <span class="n">TestDao</span><span class="o">{</span>
      <span class="nd">@Autowired</span>
      <span class="kd">private</span> <span class="n">MongoTemplate</span> <span class="n">mongoTemplate</span><span class="o">;</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">User</span> <span class="nf">findByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">mongoTemplate</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">Query</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">Criteria</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">).</span><span class="na">is</span><span class="o">(</span><span class="n">name</span><span class="o">)),</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="spring-data-redis">Spring Data Redis</h3>
<h4 id="spring配置-9">Spring配置</h4>
<p><strong>使用JdkSerializationRedisSerializer时，存储在Redis里的对象必须实现Serializable接口</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@ComponentScan</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>
      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">RedisConnectionFactory</span> <span class="nf">redisConnectionFactory</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">JedisConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JedisConnectionFactory</span><span class="o">();</span>
          <span class="n">connectionFactory</span><span class="o">.</span><span class="na">setHostName</span><span class="o">(</span><span class="s">&#34;127.0.0.1&#34;</span><span class="o">);</span>
          <span class="n">connectionFactory</span><span class="o">.</span><span class="na">setPort</span><span class="o">(</span><span class="n">6379</span><span class="o">);</span>
          <span class="n">connectionFactory</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;redis&#34;</span><span class="o">);</span>
          <span class="n">connectionFactory</span><span class="o">.</span><span class="na">setUsePool</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">connectionFactory</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">RedisTemplate</span> <span class="nf">redisTemplate</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">RedisTemplate</span> <span class="n">redisTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RedisTemplate</span><span class="o">();</span>
          <span class="n">redisTemplate</span><span class="o">.</span><span class="na">setConnectionFactory</span><span class="o">(</span><span class="n">redisConnectionFactory</span><span class="o">());</span>
          <span class="n">redisTemplate</span><span class="o">.</span><span class="na">setKeySerializer</span><span class="o">(</span><span class="k">new</span> <span class="n">StringRedisSerializer</span><span class="o">());</span>
          <span class="n">redisTemplate</span><span class="o">.</span><span class="na">setValueSerializer</span><span class="o">(</span><span class="k">new</span> <span class="n">JdkSerializationRedisSerializer</span><span class="o">());</span>
          <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="测试">测试</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="o">{</span>
          <span class="n">AnnotationConfigApplicationContext</span> <span class="n">applicationContext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">SpringConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
          <span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">redisTemplate</span> <span class="o">=</span> <span class="n">applicationContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">RedisTemplate</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
          <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;TestKey&#34;</span><span class="o">,</span> <span class="s">&#34;TestValue&#34;</span><span class="o">);</span>
          <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;TestKey&#34;</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="spring缓存">Spring缓存</h2>
<h3 id="缓存管理器">缓存管理器</h3>
<p>Spring 3.1内置了五个缓存管理器实现，如下所示：</p>
<ol>
<li>SimpleCacheManager</li>
<li>NoOpCacheManager</li>
<li>ConcurrentMapCacheManager</li>
<li>CompositeCacheManager</li>
<li>EhCacheCacheManager</li>
</ol>
<p>除了核心的Spring框架，Spring Data又提供了两个缓存管理器：</p>
<ol>
<li>RedisCacheManager（来自于Spring Data Redis项目）</li>
<li>GemfireCacheManager（来自于Spring Data GemFire项目）</li>
</ol>
<h3 id="为方法添加注解以支持缓存">为方法添加注解以支持缓存</h3>
<p>Spring提供了四个注解来声明缓存规则</p>
<table>
<thead>
<tr>
<th style="text-align:center">注解</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">@Cacheable</td>
<td style="text-align:center">调用方法之前，先在缓存中查找方法的返回值。如果找到，就会返回缓存的值。否则的话，这个方法就会被调用，返回值会放到缓存之中</td>
</tr>
<tr>
<td style="text-align:center">@CachePut</td>
<td style="text-align:center">表明Spring应该将方法的返回值放到缓存中。在方法的调用前并不会检查缓存，方法始终都会被调用</td>
</tr>
<tr>
<td style="text-align:center">@CacheEvict</td>
<td style="text-align:center">表明Spring应该在缓存中清除一个或多个条目</td>
</tr>
<tr>
<td style="text-align:center">@Caching</td>
<td style="text-align:center">这是一个分组的注解，能够同时应用多个其他的缓存注解</td>
</tr>
</tbody>
</table>
<p>@Cacheable和@CachePut有一些共有的属性</p>
<table>
<thead>
<tr>
<th style="text-align:center">属性</th>
<th style="text-align:center">类型</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">value</td>
<td style="text-align:center">String[]</td>
<td style="text-align:center">要使用的缓存名称</td>
</tr>
<tr>
<td style="text-align:center">condition</td>
<td style="text-align:center">String</td>
<td style="text-align:center">SpEL表达式，如果得到的值是false的话，不会将缓存应用到方法调用上</td>
</tr>
<tr>
<td style="text-align:center">key</td>
<td style="text-align:center">String</td>
<td style="text-align:center">SpEL表达式，用来计算自定义的缓存key</td>
</tr>
<tr>
<td style="text-align:center">unless</td>
<td style="text-align:center">String</td>
<td style="text-align:center">SpEL表达式，如果得到的值是true的话，返回值不会放到缓存之中</td>
</tr>
</tbody>
</table>
<p>@CacheEvict注解的属性，指定了哪些缓存条目应该被移除掉</p>
<table>
<thead>
<tr>
<th style="text-align:center">属性</th>
<th style="text-align:center">类型</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">value</td>
<td style="text-align:center">String[]</td>
<td style="text-align:center">要使用的缓存名称</td>
</tr>
<tr>
<td style="text-align:center">key</td>
<td style="text-align:center">String</td>
<td style="text-align:center">SpEL表达式，用来计算自定义的缓存key</td>
</tr>
<tr>
<td style="text-align:center">condition</td>
<td style="text-align:center">String</td>
<td style="text-align:center">SpEL表达式，如果得到的值是false的话，缓存不会应用到方法调用上</td>
</tr>
<tr>
<td style="text-align:center">allEntries</td>
<td style="text-align:center">boolean</td>
<td style="text-align:center">如果为true的话，特定缓存的所有条目都会被移除掉</td>
</tr>
<tr>
<td style="text-align:center">beforeInvocation</td>
<td style="text-align:center">boolean</td>
<td style="text-align:center">如果为true的话，在方法调用之前移除条目。如果为 false （默认值）的话，在方法成功调用之后再移除条目</td>
</tr>
</tbody>
</table>
<h3 id="自定义缓存key">自定义缓存key</h3>
<p>Spring提供了多个用来定义缓存规则的SpEL扩展</p>
<table>
<thead>
<tr>
<th style="text-align:center">表达式</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">#root.args</td>
<td style="text-align:center">传递给缓存方法的参数，形式为数组</td>
</tr>
<tr>
<td style="text-align:center">#root.caches</td>
<td style="text-align:center">该方法执行时所对应的缓存，形式为数组</td>
</tr>
<tr>
<td style="text-align:center">#root.target</td>
<td style="text-align:center">目标对象</td>
</tr>
<tr>
<td style="text-align:center">#root.targetClass</td>
<td style="text-align:center">目标对象的类，是 #root.target.class 的简写形式</td>
</tr>
<tr>
<td style="text-align:center">#root.method</td>
<td style="text-align:center">缓存方法</td>
</tr>
<tr>
<td style="text-align:center">#root.methodName</td>
<td style="text-align:center">缓存方法的名字，是 #root.method.name 的简写形式</td>
</tr>
<tr>
<td style="text-align:center">#result</td>
<td style="text-align:center">方法调用的返回值（不能用在 @Cacheable 注解上）</td>
</tr>
<tr>
<td style="text-align:center">#Argument</td>
<td style="text-align:center">任意的方法参数名（如 #argName ）或参数索引（如 #a0 或 #p0 ）</td>
</tr>
</tbody>
</table>
<h3 id="使用redis缓存">使用Redis缓存</h3>
<h4 id="spring配置-10">Spring配置</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@ComponentScan</span>
  <span class="nd">@EnableCaching</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>
      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">RedisConnectionFactory</span> <span class="nf">redisConnectionFactory</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">JedisConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JedisConnectionFactory</span><span class="o">();</span>
          <span class="n">connectionFactory</span><span class="o">.</span><span class="na">setHostName</span><span class="o">(</span><span class="s">&#34;127.0.0.1&#34;</span><span class="o">);</span>
          <span class="n">connectionFactory</span><span class="o">.</span><span class="na">setPort</span><span class="o">(</span><span class="n">6379</span><span class="o">);</span>
          <span class="n">connectionFactory</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&#34;redis&#34;</span><span class="o">);</span>
          <span class="n">connectionFactory</span><span class="o">.</span><span class="na">setUsePool</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">connectionFactory</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">RedisTemplate</span> <span class="nf">redisTemplate</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">RedisTemplate</span> <span class="n">redisTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RedisTemplate</span><span class="o">();</span>
          <span class="n">redisTemplate</span><span class="o">.</span><span class="na">setConnectionFactory</span><span class="o">(</span><span class="n">redisConnectionFactory</span><span class="o">());</span>
          <span class="n">redisTemplate</span><span class="o">.</span><span class="na">setKeySerializer</span><span class="o">(</span><span class="k">new</span> <span class="n">StringRedisSerializer</span><span class="o">());</span>
          <span class="n">redisTemplate</span><span class="o">.</span><span class="na">setValueSerializer</span><span class="o">(</span><span class="k">new</span> <span class="n">JdkSerializationRedisSerializer</span><span class="o">());</span>
          <span class="k">return</span> <span class="n">redisTemplate</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">CacheManager</span> <span class="nf">cacheManager</span><span class="o">()</span> <span class="o">{</span>
          <span class="k">return</span> <span class="k">new</span> <span class="n">RedisCacheManager</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">());</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="在service层做缓存">在Service层做缓存</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Service</span>
  <span class="nd">@Transactional</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestServiceImpl</span> <span class="kd">implements</span> <span class="n">TestService</span> <span class="o">{</span>

      <span class="nd">@Autowired</span>
      <span class="kd">private</span> <span class="n">TestDao</span> <span class="n">testDao</span><span class="o">;</span>

      <span class="nd">@Cacheable</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;user&#34;</span><span class="o">,</span> <span class="n">key</span> <span class="o">=</span> <span class="s">&#34;&#39;user.name.&#39; + #name&#34;</span><span class="o">)</span>
      <span class="kd">public</span> <span class="n">User</span> <span class="nf">findByName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="n">testDao</span><span class="o">.</span><span class="na">findByName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="spring与远程服务">Spring与远程服务</h2>
<h3 id="spring集成rmi">Spring集成RMI</h3>
<h4 id="编写服务">编写服务</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TestService</span> <span class="o">{</span>
      <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">();</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestServiceImpl</span> <span class="kd">implements</span> <span class="n">TestService</span> <span class="o">{</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Hello World!&#34;</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="服务端">服务端</h4>
<h5 id="spring配置-11">Spring配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@ComponentScan</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>
      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">RmiServiceExporter</span> <span class="nf">rmiServiceExporter</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">RmiServiceExporter</span> <span class="n">rmiServiceExporter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RmiServiceExporter</span><span class="o">();</span>
          <span class="n">rmiServiceExporter</span><span class="o">.</span><span class="na">setServiceName</span><span class="o">(</span><span class="s">&#34;testService&#34;</span><span class="o">);</span>
          <span class="n">rmiServiceExporter</span><span class="o">.</span><span class="na">setService</span><span class="o">(</span><span class="k">new</span> <span class="n">TestServiceImpl</span><span class="o">());</span>
          <span class="n">rmiServiceExporter</span><span class="o">.</span><span class="na">setServiceInterface</span><span class="o">(</span><span class="n">TestService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">rmiServiceExporter</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="测试代码">测试代码</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="o">{</span>
          <span class="n">AnnotationConfigApplicationContext</span> <span class="n">applicationContext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">SpringConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="客户端">客户端</h4>
<h5 id="spring配置-12">Spring配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@ComponentScan</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>
      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">RmiProxyFactoryBean</span> <span class="nf">rmiProxyFactoryBean</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">RmiProxyFactoryBean</span> <span class="n">rmiProxyFactoryBean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RmiProxyFactoryBean</span><span class="o">();</span>
          <span class="n">rmiProxyFactoryBean</span><span class="o">.</span><span class="na">setServiceInterface</span><span class="o">(</span><span class="n">TestService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
          <span class="n">rmiProxyFactoryBean</span><span class="o">.</span><span class="na">setServiceUrl</span><span class="o">(</span><span class="s">&#34;rmi://127.0.0.1:1099/testService&#34;</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">rmiProxyFactoryBean</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="测试代码-1">测试代码</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="o">{</span>
          <span class="n">AnnotationConfigApplicationContext</span> <span class="n">applicationContext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">SpringConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
          <span class="n">TestService</span> <span class="n">testService</span> <span class="o">=</span> <span class="n">applicationContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">TestService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
          <span class="n">testService</span><span class="o">.</span><span class="na">doSomething</span><span class="o">();</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="spring-jms">Spring JMS</h2>
<p>发送消息时，Spring JMS通过 JmsTemplate 来发送；接收消息时，有两种方式：一是通过JmsTemplate接收。二是通过消息驱动的Bean来接收</p>
<h3 id="队列模式">队列模式</h3>
<h4 id="发送方">发送方</h4>
<h5 id="spring配置-13">Spring配置</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@ComponentScan</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">ConnectionFactory</span> <span class="nf">connectionFactory</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">ActiveMQConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ActiveMQConnectionFactory</span><span class="o">();</span>
          <span class="n">connectionFactory</span><span class="o">.</span><span class="na">setBrokerURL</span><span class="o">(</span><span class="s">&#34;tcp://127.0.0.1:61616&#34;</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">connectionFactory</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">MessageConverter</span> <span class="nf">messageConverter</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">MappingJackson2MessageConverter</span> <span class="n">messageConverter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MappingJackson2MessageConverter</span><span class="o">();</span>
          <span class="n">messageConverter</span><span class="o">.</span><span class="na">setTargetType</span><span class="o">(</span><span class="n">MessageType</span><span class="o">.</span><span class="na">TEXT</span><span class="o">);</span>
          <span class="n">messageConverter</span><span class="o">.</span><span class="na">setTypeIdPropertyName</span><span class="o">(</span><span class="s">&#34;type&#34;</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">messageConverter</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">JmsTemplate</span> <span class="nf">jmsTemplate</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">JmsTemplate</span> <span class="n">jmsTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JmsTemplate</span><span class="o">();</span>
          <span class="n">jmsTemplate</span><span class="o">.</span><span class="na">setConnectionFactory</span><span class="o">(</span><span class="n">connectionFactory</span><span class="o">());</span>
          <span class="n">jmsTemplate</span><span class="o">.</span><span class="na">setDefaultDestinationName</span><span class="o">(</span><span class="s">&#34;MyQueue&#34;</span><span class="o">);</span>
          <span class="n">jmsTemplate</span><span class="o">.</span><span class="na">setMessageConverter</span><span class="o">(</span><span class="n">messageConverter</span><span class="o">());</span>
          <span class="k">return</span> <span class="n">jmsTemplate</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="测试代码-2">测试代码</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Server</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="o">{</span>
          <span class="n">AnnotationConfigApplicationContext</span> <span class="n">applicationContext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">SpringConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
          <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span>
          <span class="n">user</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="s">&#34;1&#34;</span><span class="o">);</span>
          <span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;Jim&#34;</span><span class="o">);</span>
          <span class="n">JmsTemplate</span> <span class="n">jmsTemplate</span> <span class="o">=</span> <span class="n">applicationContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">JmsTemplate</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
          <span class="n">jmsTemplate</span><span class="o">.</span><span class="na">convertAndSend</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="接收方">接收方</h4>
<h5 id="方式一使用jmstemplate">方式一：使用JmsTemplate</h5>
<h6 id="spring配置-14">Spring配置</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@ComponentScan</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">ConnectionFactory</span> <span class="nf">connectionFactory</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">ActiveMQConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ActiveMQConnectionFactory</span><span class="o">();</span>
          <span class="n">connectionFactory</span><span class="o">.</span><span class="na">setBrokerURL</span><span class="o">(</span><span class="s">&#34;tcp://127.0.0.1:61616&#34;</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">connectionFactory</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">MessageConverter</span> <span class="nf">messageConverter</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">MappingJackson2MessageConverter</span> <span class="n">messageConverter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MappingJackson2MessageConverter</span><span class="o">();</span>
          <span class="n">messageConverter</span><span class="o">.</span><span class="na">setTargetType</span><span class="o">(</span><span class="n">MessageType</span><span class="o">.</span><span class="na">TEXT</span><span class="o">);</span>
          <span class="n">messageConverter</span><span class="o">.</span><span class="na">setTypeIdPropertyName</span><span class="o">(</span><span class="s">&#34;type&#34;</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">messageConverter</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">JmsTemplate</span> <span class="nf">jmsTemplate</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">JmsTemplate</span> <span class="n">jmsTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JmsTemplate</span><span class="o">();</span>
          <span class="n">jmsTemplate</span><span class="o">.</span><span class="na">setConnectionFactory</span><span class="o">(</span><span class="n">connectionFactory</span><span class="o">());</span>
          <span class="n">jmsTemplate</span><span class="o">.</span><span class="na">setDefaultDestinationName</span><span class="o">(</span><span class="s">&#34;MyQueue&#34;</span><span class="o">);</span>
          <span class="n">jmsTemplate</span><span class="o">.</span><span class="na">setMessageConverter</span><span class="o">(</span><span class="n">messageConverter</span><span class="o">());</span>
          <span class="k">return</span> <span class="n">jmsTemplate</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="测试代码-3">测试代码</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="o">{</span>
          <span class="n">AnnotationConfigApplicationContext</span> <span class="n">applicationContext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">SpringConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
          <span class="n">JmsTemplate</span> <span class="n">jmsTemplate</span> <span class="o">=</span> <span class="n">applicationContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">JmsTemplate</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
          <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">jmsTemplate</span><span class="o">.</span><span class="na">receiveAndConvert</span><span class="o">();</span>
      <span class="o">}</span>
  <span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h5 id="方式二通过消息驱动的bean">方式二：通过消息驱动的Bean</h5>
<h6 id="spring配置-15">Spring配置</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Configuration</span>
  <span class="nd">@ComponentScan</span>
  <span class="nd">@EnableJms</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringConfig</span> <span class="o">{</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">ConnectionFactory</span> <span class="nf">connectionFactory</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">ActiveMQConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ActiveMQConnectionFactory</span><span class="o">();</span>
          <span class="n">connectionFactory</span><span class="o">.</span><span class="na">setBrokerURL</span><span class="o">(</span><span class="s">&#34;tcp://127.0.0.1:61616&#34;</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">connectionFactory</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">MessageConverter</span> <span class="nf">messageConverter</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">MappingJackson2MessageConverter</span> <span class="n">messageConverter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MappingJackson2MessageConverter</span><span class="o">();</span>
          <span class="n">messageConverter</span><span class="o">.</span><span class="na">setTargetType</span><span class="o">(</span><span class="n">MessageType</span><span class="o">.</span><span class="na">TEXT</span><span class="o">);</span>
          <span class="n">messageConverter</span><span class="o">.</span><span class="na">setTypeIdPropertyName</span><span class="o">(</span><span class="s">&#34;type&#34;</span><span class="o">);</span>
          <span class="k">return</span> <span class="n">messageConverter</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="nd">@Bean</span>
      <span class="kd">public</span> <span class="n">JmsListenerContainerFactory</span><span class="o">&lt;?&gt;</span> <span class="n">jmsListenerContainerFactory</span><span class="o">()</span> <span class="o">{</span>
          <span class="n">DefaultJmsListenerContainerFactory</span> <span class="n">containerFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultJmsListenerContainerFactory</span><span class="o">();</span>
          <span class="n">containerFactory</span><span class="o">.</span><span class="na">setConnectionFactory</span><span class="o">(</span><span class="n">connectionFactory</span><span class="o">());</span>
          <span class="n">containerFactory</span><span class="o">.</span><span class="na">setMessageConverter</span><span class="o">(</span><span class="n">messageConverter</span><span class="o">());</span>
          <span class="k">return</span> <span class="n">containerFactory</span><span class="o">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h6 id="service">Service</h6>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">  <span class="nd">@Service</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestServiceImpl</span> <span class="kd">implements</span> <span class="n">TestService</span> <span class="o">{</span>

      <span class="nd">@JmsListener</span><span class="o">(</span><span class="n">destination</span> <span class="o">=</span> <span class="s">&#34;MyQueue&#34;</span><span class="o">)</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">receive</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
          <span class="c1">//doSomething
</span><span class="c1"></span>      <span class="o">}</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="发布订阅模式">发布/订阅模式</h3>
<h4 id="发送方-1">发送方</h4>
<p>同队列模式，只需设置jmsTemplate.setPubSubDomain(true)即可</p>
<h4 id="接收方-1">接收方</h4>
<h5 id="方式一使用jmstemplate-1">方式一：使用JmsTemplate</h5>
<p>同队列模式，只需设置jmsTemplate.setPubSubDomain(true)即可</p>
<h5 id="方式二通过消息驱动的bean-1">方式二：通过消息驱动的Bean</h5>
<p>同队列模式，只需设置DefaultJmsListenerContainerFactory.setPubSubDomain(true)即可</p>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content"><a href="http://jason207010.github.io/post/%E3%80%8ASpring%20%E5%AE%9E%E6%88%98%E3%80%8B%E7%AC%94%E8%AE%B0.html">Jason</a>
      </span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2017-07-14
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://jason207010.github.io/tags/java/">Java</a>
          <a href="http://jason207010.github.io/tags/spring/">Spring</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/PlantUML%20mode%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97.html">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">PlantUML mode使用指南</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/JPA%20%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97.html">
            <span class="next-text nav-default">JPA 开发指南</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="https://github.com/jason207010" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="http://jason207010.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2015 -
    2021
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Jason
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.js" integrity="sha256-AC9ChpELidrhGHX23ZU53vmRdz3FhKaN9E28+BbcWBw=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js" integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin="anonymous"></script>
  















</body>
</html>
